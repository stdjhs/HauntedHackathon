<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸‡åœ£èŠ‚MBTIæµ‹è¯• - ç‹¬ç«‹ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .hidden { display: none; }

        .card {
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #6b1d9e;
            border-radius: 20px;
            padding: 40px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(107, 29, 158, 0.3);
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            text-align: center;
            font-size: 36px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #F8A51C, #F25C5C);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        h2 {
            text-align: center;
            font-size: 24px;
            margin-bottom: 20px;
            color: #F8A51C;
        }

        .option {
            background: rgba(107, 29, 158, 0.3);
            border: 2px solid #6b1d9e;
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 18px;
        }

        .option:hover {
            background: rgba(107, 29, 158, 0.5);
            transform: translateX(10px);
            box-shadow: 0 5px 20px rgba(248, 165, 28, 0.4);
        }

        .option.selected {
            background: rgba(248, 165, 28, 0.3);
            border-color: #F8A51C;
            box-shadow: 0 0 30px rgba(248, 165, 28, 0.6);
        }

        .button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #F8A51C, #F25C5C);
            border: none;
            border-radius: 25px;
            color: white;
            font-size: 18px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s;
        }

        .button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(248, 165, 28, 0.5);
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
            box-shadow: 0 0 10px rgba(248, 165, 28, 0.3);
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #F8A51C, #F25C5C);
            transition: width 0.5s ease;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .progress-text {
            text-align: center;
            color: #F8A51C;
            font-size: 14px;
            margin-top: 10px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .result {
            text-align: center;
        }

        .type-badge {
            font-size: 100px;
            margin: 20px 0;
        }

        .restart-btn {
            background: linear-gradient(135deg, #6b1d9e, #9d4edd);
            margin-top: 30px;
        }

        /* æ˜Ÿç©ºèƒŒæ™¯ */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }

        /* ç­”é¢˜è®¡æ—¶å™¨ */
        .timer {
            text-align: center;
            color: #F8A51C;
            font-size: 16px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
        }

        /* äººæ ¼å€¾å‘æç¤º */
        .personality-hint {
            text-align: center;
            color: #9d4edd;
            font-size: 14px;
            margin: 10px 0;
            padding: 10px;
            background: rgba(157, 78, 221, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(157, 78, 221, 0.3);
        }

        /* é¼“åŠ±æ–‡å­— */
        .encouragement {
            text-align: center;
            color: #F8A51C;
            font-size: 16px;
            margin: 15px 0;
            min-height: 24px;
            animation: fadeInUp 0.5s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ç‚¹å‡»ç‰¹æ•ˆ */
        .click-effect {
            position: absolute;
            pointer-events: none;
            animation: clickBurst 0.5s ease;
        }

        @keyframes clickBurst {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.8;
            }
            100% {
                transform: scale(2);
                opacity: 0;
            }
        }

        /* ç²’å­æ•ˆæœ */
        .particle {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            pointer-events: none;
            animation: particleFloat 1s ease-out forwards;
        }

        @keyframes particleFloat {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(var(--dx), var(--dy)) scale(0);
                opacity: 0;
            }
        }

        /* æˆå°±å¾½ç«  */
        .achievement {
            display: inline-block;
            padding: 8px 15px;
            margin: 5px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #000;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            animation: achievementPop 0.5s ease;
        }

        @keyframes achievementPop {
            0% {
                transform: scale(0) rotate(-180deg);
                opacity: 0;
            }
            50% {
                transform: scale(1.2) rotate(0deg);
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        /* æ›´ç‚«é…·çš„ç»“æœé¡µ */
        .result-type-badge {
            font-size: 120px;
            animation: resultFloat 3s ease-in-out infinite;
            filter: drop-shadow(0 0 20px rgba(248, 165, 28, 0.5));
        }

        @keyframes resultFloat {
            0%, 100% {
                transform: translateY(0) rotate(-5deg);
            }
            50% {
                transform: translateY(-20px) rotate(5deg);
            }
        }

        .result-card-enhanced {
            background: rgba(0, 0, 0, 0.8);
            border: 3px solid #F8A51C;
            box-shadow: 0 0 50px rgba(248, 165, 28, 0.5);
            animation: resultGlow 2s ease-in-out infinite;
        }

        @keyframes resultGlow {
            0%, 100% {
                box-shadow: 0 0 50px rgba(248, 165, 28, 0.5);
            }
            50% {
                box-shadow: 0 0 80px rgba(248, 165, 28, 0.8);
            }
        }

        /* åˆ†äº«æŒ‰é’® */
        .share-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }

        .share-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #6b1d9e, #9d4edd);
            border: none;
            border-radius: 20px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .share-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 20px rgba(157, 78, 221, 0.5);
        }

        /* ä¿å­˜ç»“æœæŒ‰é’® */
        .save-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #F8A51C, #F25C5C);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 30px;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(248, 165, 28, 0.5);
            transition: all 0.3s;
            z-index: 1000;
        }

        .save-btn:hover {
            transform: scale(1.1) rotate(10deg);
        }

        /* å®ŒæˆåŠ¨ç”» */
        .completion-animation {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 100px;
            animation: completionPop 1s ease;
            pointer-events: none;
            z-index: 2000;
        }

        @keyframes completionPop {
            0% {
                transform: translate(-50%, -50%) scale(0) rotate(0deg);
                opacity: 0;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.5) rotate(180deg);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(1) rotate(360deg);
                opacity: 0;
            }
        }

        /* æƒŠå“éŸ³æ•ˆæç¤º */
        .scare-indicator {
            position: fixed;
            bottom: 20px;
            left: 20px;
            padding: 10px 20px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #F25C5C;
            border-radius: 10px;
            color: #F25C5C;
            font-size: 14px;
            animation: scarePulse 2s infinite;
            z-index: 1000;
        }

        @keyframes scarePulse {
            0%, 100% { opacity: 0.7; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
        }

        /* éšæœºææ€–å…ƒç´  */
        .scary-element {
            position: fixed;
            pointer-events: none;
            animation: scaryAppear 0.3s ease;
            z-index: 1500;
        }

        @keyframes scaryAppear {
            0% {
                opacity: 0;
                transform: scale(0) rotate(-180deg);
            }
            50% {
                opacity: 1;
                transform: scale(1.2) rotate(0deg);
            }
            100% {
                opacity: 0;
                transform: scale(1) rotate(180deg);
            }
        }

        /* å¹½çµæ¸¸èµ° */
        .ghost-walk {
            position: fixed;
            font-size: 60px;
            animation: ghostWalk 5s linear;
            pointer-events: none;
            z-index: 100;
            opacity: 0.7;
        }

        @keyframes ghostWalk {
            0% {
                left: -100px;
                top: 50%;
                transform: scale(1) rotate(0deg);
            }
            25% {
                left: 25%;
                top: 20%;
                transform: scale(1.2) rotate(5deg);
            }
            50% {
                left: 50%;
                top: 50%;
                transform: scale(1) rotate(0deg);
            }
            75% {
                left: 75%;
                top: 30%;
                transform: scale(1.2) rotate(-5deg);
            }
            100% {
                left: 100%;
                top: 50%;
                transform: scale(1) rotate(0deg);
            }
        }

        /* è™è é£è¿‡ */
        .bat-fly {
            position: fixed;
            font-size: 40px;
            animation: batFly 3s ease-in-out;
            pointer-events: none;
            z-index: 100;
        }

        @keyframes batFly {
            0% {
                left: -50px;
                top: 10%;
                transform: scale(1);
            }
            50% {
                left: 50%;
                top: 15%;
                transform: scale(1.5) rotate(10deg);
            }
            100% {
                left: 100%;
                top: 5%;
                transform: scale(1);
            }
        }

        /* å—ç“œç¯é—ªçƒ */
        .pumpkin-glow {
            position: fixed;
            font-size: 80px;
            animation: pumpkinGlow 0.5s ease-in-out;
            pointer-events: none;
            z-index: 200;
        }

        @keyframes pumpkinGlow {
            0%, 100% {
                filter: drop-shadow(0 0 10px rgba(255, 102, 0, 0.3));
                transform: scale(1);
            }
            50% {
                filter: drop-shadow(0 0 30px rgba(255, 102, 0, 1));
                transform: scale(1.1);
            }
        }

        /* æ‘‡æ‘†èœ˜è›› */
        .spider-swing {
            position: fixed;
            top: 0;
            left: 50%;
            font-size: 50px;
            animation: spiderSwing 3s ease-in-out;
            pointer-events: none;
            z-index: 200;
            transform-origin: top center;
        }

        @keyframes spiderSwing {
            0%, 100% {
                transform: rotate(-20deg);
            }
            50% {
                transform: rotate(20deg);
            }
        }

        /* é¬¼ç« */
        .will-o-wisp {
            position: fixed;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, rgba(0, 255, 0, 0.8) 0%, transparent 70%);
            border-radius: 50%;
            animation: willOWisp 4s ease-in-out infinite;
            pointer-events: none;
            z-index: 100;
        }

        @keyframes willOWisp {
            0%, 100% {
                left: 10%;
                bottom: 10%;
                opacity: 0.3;
            }
            25% {
                left: 30%;
                bottom: 30%;
                opacity: 0.8;
            }
            50% {
                left: 50%;
                bottom: 50%;
                opacity: 0.5;
            }
            75% {
                left: 70%;
                bottom: 30%;
                opacity: 0.8;
            }
        }

        /* å±å¹•éœ‡åŠ¨æ•ˆæœ */
        .screen-shake {
            animation: screenShake 0.3s ease;
        }

        @keyframes screenShake {
            0%, 100% { transform: translate(0, 0); }
            10% { transform: translate(-5px, -5px); }
            20% { transform: translate(5px, 5px); }
            30% { transform: translate(-5px, 5px); }
            40% { transform: translate(5px, -5px); }
            50% { transform: translate(-5px, -5px); }
            60% { transform: translate(5px, 5px); }
            70% { transform: translate(-5px, 5px); }
            80% { transform: translate(5px, -5px); }
            90% { transform: translate(-5px, -5px); }
        }

        /* é—ªçƒæ•ˆæœ */
        .screen-flash {
            animation: screenFlash 0.2s ease;
        }

        @keyframes screenFlash {
            0%, 100% { background: transparent; }
            50% { background: rgba(255, 102, 0, 0.3); }
        }

        /* é€‰æ‹©ç¡®è®¤ç‰¹æ•ˆ */
        .answer-confirmation {
            position: absolute;
            right: -50px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 30px;
            animation: answerConfirm 0.5s ease;
            pointer-events: none;
        }

        @keyframes answerConfirm {
            0% {
                opacity: 0;
                transform: translateY(-50%) scale(0) rotate(0deg);
            }
            50% {
                opacity: 1;
                transform: translateY(-50%) scale(1.2) rotate(180deg);
            }
            100% {
                opacity: 0;
                transform: translateY(-50%) scale(1) rotate(360deg);
            }
        }

        /* è¿›åº¦æƒŠå“æç¤º */
        .scare-msg {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px 40px;
            background: rgba(0, 0, 0, 0.9);
            border: 3px solid #F25C5C;
            border-radius: 15px;
            color: #F25C5C;
            font-size: 24px;
            font-weight: bold;
            animation: scareMsg 1s ease;
            pointer-events: none;
            z-index: 2000;
        }

        @keyframes scareMsg {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0);
            }
            30% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.2);
            }
            70% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
        }

        /* å£°éŸ³å¯è§†åŒ– */
        .sound-wave {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 3px;
            z-index: 1000;
        }

        .sound-wave span {
            width: 4px;
            height: 20px;
            background: linear-gradient(to top, #F8A51C, #F25C5C);
            animation: soundWave 1s ease-in-out infinite;
        }

        .sound-wave span:nth-child(2) { animation-delay: 0.1s; }
        .sound-wave span:nth-child(3) { animation-delay: 0.2s; }
        .sound-wave span:nth-child(4) { animation-delay: 0.3s; }
        .sound-wave span:nth-child(5) { animation-delay: 0.4s; }

        @keyframes soundWave {
            0%, 100% { height: 10px; }
            50% { height: 30px; }
        }

        /* æƒŠå“ç­‰çº§æç¤º */
        .level-warning {
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            background: rgba(242, 92, 92, 0.2);
            border: 2px solid #F25C5C;
            border-radius: 10px;
            color: #F25C5C;
            font-weight: bold;
            animation: levelWarning 0.5s ease;
            z-index: 1000;
        }

        @keyframes levelWarning {
            0% {
                opacity: 0;
                transform: translateX(-50%) scale(0);
            }
            50% {
                opacity: 1;
                transform: translateX(-50%) scale(1.1);
            }
            100% {
                opacity: 1;
                transform: translateX(-50%) scale(1);
            }
        }

        /* ================ ç‚«é…·ç‰¹æ•ˆç³»ç»Ÿ ================ */

        /* å…¨æ¯æŠ•å½±æ•ˆæœ */
        .hologram-effect {
            position: fixed;
            pointer-events: none;
            z-index: 100;
            animation: hologramFlicker 2s infinite;
        }

        @keyframes hologramFlicker {
            0%, 100% { opacity: 0.8; filter: hue-rotate(0deg) brightness(1); }
            50% { opacity: 1; filter: hue-rotate(180deg) brightness(1.2); }
        }

        /* å½©è™¹æµå…‰æ•ˆæœ */
        .rainbow-stream {
            position: fixed;
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, transparent, #F8A51C, #F25C5C, #6b1d9e, #9d4edd, #00ff00, #00ffff, #F8A51C);
            animation: rainbowFlow 3s linear;
            pointer-events: none;
            z-index: 50;
        }

        @keyframes rainbowFlow {
            0% {
                left: -10px;
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                left: 100%;
                opacity: 0;
            }
        }

        /* é­”æ³•é˜µ */
        .magic-circle {
            position: fixed;
            width: 300px;
            height: 300px;
            border: 3px solid rgba(248, 165, 28, 0.5);
            border-radius: 50%;
            animation: magicCircleRotate 10s linear infinite;
            pointer-events: none;
            z-index: 100;
        }

        .magic-circle::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            height: 80%;
            border: 2px solid rgba(242, 92, 92, 0.5);
            border-radius: 50%;
            animation: magicCircleRotate 7s linear infinite reverse;
        }

        .magic-circle::after {
            content: 'â­';
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 30px;
            animation: magicStarSpin 3s linear infinite;
        }

        @keyframes magicCircleRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes magicStarSpin {
            from { transform: translateX(-50%) rotate(0deg); }
            to { transform: translateX(-50%) rotate(360deg); }
        }

        /* é›·ç”µæ•ˆæœ */
        .lightning-bolt {
            position: fixed;
            width: 6px;
            height: 100%;
            background: linear-gradient(to bottom, transparent, #fff, #F8A51C, transparent);
            animation: lightningFlash 0.2s ease;
            pointer-events: none;
            z-index: 2000;
            box-shadow: 0 0 20px #F8A51C;
        }

        @keyframes lightningFlash {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }

        /* èƒ½é‡æ³¢ */
        .energy-wave {
            position: fixed;
            border: 3px solid rgba(248, 165, 28, 0.8);
            border-radius: 50%;
            animation: energyWaveExpand 1.5s ease-out;
            pointer-events: none;
            z-index: 1000;
        }

        @keyframes energyWaveExpand {
            0% {
                width: 0;
                height: 0;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                opacity: 1;
            }
            100% {
                width: 500px;
                height: 500px;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                opacity: 0;
            }
        }

        /* å…¨å±çƒŸèŠ± */
        .firework {
            position: fixed;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            animation: fireworkExplode 1s ease-out;
            pointer-events: none;
            z-index: 1500;
        }

        @keyframes fireworkExplode {
            0% {
                transform: scale(1);
                box-shadow: 0 0 0 0 currentColor;
            }
            100% {
                transform: scale(20);
                box-shadow: 0 0 0 50px transparent;
            }
        }

        /* æµ®ç©ºæ–‡å­— */
        .floating-text {
            position: fixed;
            font-size: 30px;
            font-weight: bold;
            animation: floatingTextUp 2s ease-out;
            pointer-events: none;
            z-index: 2000;
            text-shadow: 0 0 20px currentColor;
        }

        @keyframes floatingTextUp {
            0% {
                opacity: 0;
                transform: translateY(0) scale(0.5);
            }
            20% {
                opacity: 1;
                transform: translateY(-50px) scale(1.2);
            }
            100% {
                opacity: 0;
                transform: translateY(-150px) scale(1);
            }
        }

        /* é»‘æ´æ•ˆæœ */
        .black-hole {
            position: fixed;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: radial-gradient(circle, transparent 30%, rgba(0, 0, 0, 0.8) 60%, black 100%);
            animation: blackHoleSpin 3s linear infinite;
            pointer-events: none;
            z-index: 1500;
        }

        @keyframes blackHoleSpin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* æå…‰æ•ˆæœ */
        .aurora {
            position: fixed;
            width: 200%;
            height: 200px;
            background: linear-gradient(90deg, transparent, rgba(157, 78, 221, 0.3), rgba(248, 165, 28, 0.3), rgba(0, 255, 0, 0.3), transparent);
            animation: auroraFlow 8s ease-in-out infinite;
            pointer-events: none;
            z-index: 50;
        }

        @keyframes auroraFlow {
            0%, 100% {
                top: -100px;
                transform: skewX(-20deg);
            }
            50% {
                top: 0;
                transform: skewX(20deg);
            }
        }

        /* æ—¶é—´å‡é€Ÿæ•ˆæœ */
        .time-slow {
            animation-duration: 5s !important;
            filter: contrast(1.2) saturate(1.5);
        }

        /* å…¨å±éœ‡åŠ¨ */
        .mega-shake {
            animation: megaShake 0.5s ease;
        }

        @keyframes megaShake {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            10% { transform: translate(-10px, -10px) rotate(-1deg); }
            20% { transform: translate(10px, 10px) rotate(1deg); }
            30% { transform: translate(-10px, 10px) rotate(-1deg); }
            40% { transform: translate(10px, -10px) rotate(1deg); }
            50% { transform: translate(-10px, -10px) rotate(-1deg); }
            60% { transform: translate(10px, 10px) rotate(1deg); }
            70% { transform: translate(-10px, 10px) rotate(-1deg); }
            80% { transform: translate(10px, -10px) rotate(1deg); }
            90% { transform: translate(-10px, -10px) rotate(-1deg); }
        }

        /* ç‚«é…·æç¤ºæ¡† */
        .mega-msg {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            padding: 30px 60px;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.95), rgba(107, 29, 158, 0.3));
            border: 4px solid;
            border-image: linear-gradient(45deg, #F8A51C, #F25C5C, #6b1d9e, #9d4edd) 1;
            border-radius: 20px;
            color: #F8A51C;
            font-size: 32px;
            font-weight: bold;
            text-align: center;
            animation: megaMsg 2s ease;
            pointer-events: none;
            z-index: 3000;
            box-shadow: 0 0 50px rgba(248, 165, 28, 0.8);
        }

        @keyframes megaMsg {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0) rotate(-180deg);
            }
            20% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.2) rotate(0deg);
            }
            80% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1) rotate(0deg);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8) rotate(180deg);
            }
        }

        /* 3Dæ—‹è½¬ç«‹æ–¹ä½“ */
        .cube {
            position: fixed;
            width: 80px;
            height: 80px;
            transform-style: preserve-3d;
            animation: cubeRotate 4s linear infinite;
            pointer-events: none;
            z-index: 1000;
        }

        .cube-face {
            position: absolute;
            width: 80px;
            height: 80px;
            background: rgba(248, 165, 28, 0.7);
            border: 2px solid rgba(242, 92, 92, 0.9);
        }

        .cube-face:nth-child(1) { transform: rotateY(0deg) translateZ(40px); }
        .cube-face:nth-child(2) { transform: rotateY(90deg) translateZ(40px); }
        .cube-face:nth-child(3) { transform: rotateY(180deg) translateZ(40px); }
        .cube-face:nth-child(4) { transform: rotateY(-90deg) translateZ(40px); }
        .cube-face:nth-child(5) { transform: rotateX(90deg) translateZ(40px); }
        .cube-face:nth-child(6) { transform: rotateX(-90deg) translateZ(40px); }

        @keyframes cubeRotate {
            from { transform: rotateX(0deg) rotateY(0deg); }
            to { transform: rotateX(360deg) rotateY(360deg); }
        }

        /* ä¼ é€é—¨ */
        .portal {
            position: fixed;
            width: 150px;
            height: 150px;
            border: 5px solid;
            border-radius: 50%;
            animation: portalSpin 3s linear infinite;
            pointer-events: none;
            z-index: 1500;
            border-image: conic-gradient(from 0deg, #F8A51C, #F25C5C, #6b1d9e, #9d4edd, #00ff00, #00ffff, #F8A51C) 1;
        }

        @keyframes portalSpin {
            from { transform: rotate(0deg) scale(1); }
            to { transform: rotate(360deg) scale(1); }
        }

        /* å…¨æ¯æŠ•å½±æ–‡å­— */
        .hologram-text {
            position: fixed;
            font-size: 60px;
            font-weight: bold;
            color: transparent;
            background: linear-gradient(45deg, #F8A51C, #F25C5C, #6b1d9e, #9d4edd);
            -webkit-background-clip: text;
            background-clip: text;
            animation: hologramText 2s infinite;
            pointer-events: none;
            z-index: 2000;
            filter: drop-shadow(0 0 10px currentColor);
        }

        @keyframes hologramText {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        /* ================ æ–°å¢å¥½ç©åŠŸèƒ½ ================ */

        /* ä¸»é¢˜åˆ‡æ¢æŒ‰é’® */
        .theme-switcher {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .theme-btn {
            padding: 10px 15px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #F8A51C;
            border-radius: 20px;
            color: #F8A51C;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .theme-btn:hover {
            background: rgba(248, 165, 28, 0.3);
            transform: scale(1.1);
        }

        .theme-btn.active {
            background: #F8A51C;
            color: black;
        }

        /* NPCå¯¹è¯æ°”æ³¡ */
        .npc-dialog {
            position: fixed;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%);
            max-width: 600px;
            padding: 15px 25px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #6b1d9e;
            border-radius: 20px;
            color: white;
            font-size: 16px;
            animation: npcDialogue 0.5s ease;
            z-index: 1500;
            box-shadow: 0 0 20px rgba(107, 29, 158, 0.5);
        }

        .npc-dialog::before {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 10px solid #6b1d9e;
        }

        .npc-avatar {
            position: absolute;
            left: -60px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 50px;
            animation: npcFloat 2s ease-in-out infinite;
        }

        @keyframes npcDialogue {
            0% {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }
            100% {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        @keyframes npcFloat {
            0%, 100% { transform: translateY(-50%); }
            50% { transform: translateY(-60%); }
        }

        /* éšæœºäº‹ä»¶æç¤º */
        .random-event {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 40px;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.95), rgba(157, 78, 221, 0.3));
            border: 4px solid #9d4edd;
            border-radius: 25px;
            text-align: center;
            animation: randomEvent 3s ease;
            pointer-events: none;
            z-index: 2500;
            box-shadow: 0 0 50px rgba(157, 78, 221, 0.8);
        }

        @keyframes randomEvent {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0);
            }
            20% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.1);
            }
            80% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
        }

        /* æŠ€èƒ½/å¤©èµ‹æ˜¾ç¤º */
        .skill-tree {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 200px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #F8A51C;
            border-radius: 15px;
            padding: 15px;
            z-index: 1000;
            animation: skillTreeSlide 0.5s ease;
        }

        @keyframes skillTreeSlide {
            from {
                transform: translateY(-50%) translateX(250px);
                opacity: 0;
            }
            to {
                transform: translateY(-50%) translateX(0);
                opacity: 1;
            }
        }

        .skill-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
            padding: 8px;
            background: rgba(248, 165, 28, 0.2);
            border-radius: 10px;
            transition: all 0.3s;
        }

        .skill-item.earned {
            background: rgba(248, 165, 28, 0.5);
            box-shadow: 0 0 15px rgba(248, 165, 28, 0.5);
        }

        .skill-icon {
            font-size: 24px;
        }

        .skill-name {
            flex: 1;
            font-size: 14px;
            color: white;
        }

        .skill-level {
            font-size: 12px;
            color: #F8A51C;
        }

        /* å¤©æ°”ç³»ç»Ÿ */
        .weather-effect {
            position: fixed;
            pointer-events: none;
            z-index: 50;
        }

        .rain-drop {
            position: absolute;
            width: 2px;
            height: 20px;
            background: linear-gradient(to bottom, transparent, #00ffff);
            animation: rainFall 1s linear;
        }

        @keyframes rainFall {
            to {
                transform: translateY(100vh);
            }
        }

        .snow-flake {
            position: absolute;
            font-size: 20px;
            animation: snowFall 3s linear;
        }

        @keyframes snowFall {
            to {
                transform: translateY(100vh) rotate(360deg);
            }
        }

        .fog-particle {
            position: absolute;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1), transparent);
            animation: fogDrift 10s ease-in-out infinite;
        }

        @keyframes fogDrift {
            0%, 100% {
                left: -200px;
                opacity: 0.3;
            }
            50% {
                left: 50%;
                opacity: 0.6;
            }
        }

        /* æ’è¡Œæ¦œ */
        .leaderboard {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 500px;
            max-height: 600px;
            background: rgba(0, 0, 0, 0.95);
            border: 3px solid #F8A51C;
            border-radius: 20px;
            padding: 30px;
            z-index: 3000;
            overflow-y: auto;
            animation: leaderboardPop 0.5s ease;
        }

        @keyframes leaderboardPop {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0);
            }
            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .leaderboard-title {
            text-align: center;
            font-size: 28px;
            color: #F8A51C;
            margin-bottom: 20px;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px;
            margin: 10px 0;
            background: rgba(107, 29, 158, 0.3);
            border-radius: 10px;
            transition: all 0.3s;
        }

        .leaderboard-item:hover {
            background: rgba(107, 29, 158, 0.5);
            transform: translateX(10px);
        }

        .leaderboard-rank {
            font-size: 24px;
            font-weight: bold;
            color: #F8A51C;
            min-width: 40px;
        }

        .leaderboard-info {
            flex: 1;
        }

        .leaderboard-name {
            font-size: 16px;
            color: white;
        }

        .leaderboard-time {
            font-size: 12px;
            color: #ccc;
        }

        .leaderboard-emoji {
            font-size: 30px;
        }

        /* æ¯æ—¥æŒ‘æˆ˜ */
        .daily-challenge {
            position: fixed;
            top: 100px;
            right: 20px;
            width: 250px;
            background: linear-gradient(135deg, rgba(242, 92, 92, 0.3), rgba(157, 78, 221, 0.3));
            border: 2px solid #F25C5C;
            border-radius: 15px;
            padding: 20px;
            z-index: 1000;
            animation: dailyChallenge 0.5s ease;
        }

        @keyframes dailyChallenge {
            from {
                transform: translateX(300px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .daily-challenge-title {
            font-size: 18px;
            color: #F25C5C;
            margin-bottom: 15px;
            text-align: center;
        }

        .daily-challenge-text {
            font-size: 14px;
            color: white;
            margin-bottom: 10px;
        }

        .daily-challenge-reward {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(255, 215, 0, 0.2);
            border-radius: 10px;
            color: #FFD700;
        }

        /* å°æ¸¸æˆå¼¹çª— */
        .mini-game {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 600px;
            background: rgba(0, 0, 0, 0.95);
            border: 3px solid #9d4edd;
            border-radius: 20px;
            padding: 30px;
            z-index: 3000;
            animation: miniGamePop 0.5s ease;
        }

        @keyframes miniGamePop {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0);
            }
            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .mini-game-title {
            text-align: center;
            font-size: 24px;
            color: #9d4edd;
            margin-bottom: 20px;
        }

        .mini-game-content {
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(157, 78, 221, 0.1);
            border-radius: 15px;
            padding: 20px;
        }

        /* è£…å¤‡ç³»ç»Ÿ */
        .equipment-panel {
            position: fixed;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 200px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #6b1d9e;
            border-radius: 15px;
            padding: 15px;
            z-index: 1000;
            animation: equipmentSlide 0.5s ease;
        }

        @keyframes equipmentSlide {
            from {
                transform: translateY(-50%) translateX(-250px);
                opacity: 0;
            }
            to {
                transform: translateY(-50%) translateX(0);
                opacity: 1;
            }
        }

        .equipment-slot {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            margin: 8px 0;
            background: rgba(107, 29, 158, 0.2);
            border-radius: 10px;
            min-height: 50px;
        }

        .equipment-slot.filled {
            background: rgba(248, 165, 28, 0.3);
            box-shadow: 0 0 15px rgba(248, 165, 28, 0.5);
        }

        .equipment-icon {
            font-size: 30px;
        }

        .equipment-info {
            flex: 1;
        }

        .equipment-name {
            font-size: 14px;
            color: white;
        }

        .equipment-bonus {
            font-size: 12px;
            color: #F8A51C;
        }

        /* èƒŒæ™¯ä¸»é¢˜å˜åŒ– */
        .theme-halloween {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
        }

        .theme-christmas {
            background: linear-gradient(135deg, #0a1929 0%, #1a3a52 50%, #2c5f7e 100%);
        }

        .theme-cyberpunk {
            background: linear-gradient(135deg, #1a0033 0%, #330066 50%, #4d0099 100%);
        }

        .theme-ocean {
            background: linear-gradient(135deg, #001a33 0%, #003366 50%, #004d99 100%);
        }

        /* åŠ¨æ€é€‰é¡¹å¡ */
        .dynamic-option {
            position: relative;
            overflow: hidden;
        }

        .dynamic-option::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .dynamic-option:hover::after {
            left: 100%;
        }

        /* ç»“æŸé®ç½© */
        .end-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 4000;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: endOverlay 1s ease;
        }

        @keyframes endOverlay {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .end-content {
            text-align: center;
            color: white;
        }

        .end-title {
            font-size: 72px;
            background: linear-gradient(45deg, #F8A51C, #F25C5C, #6b1d9e, #9d4edd);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 30px;
            animation: endTitleGlow 2s ease-in-out infinite;
        }

        @keyframes endTitleGlow {
            0%, 100% {
                filter: brightness(1);
            }
            50% {
                filter: brightness(1.5);
            }
        }

        @media (max-width: 768px) {
            .card { padding: 20px; }
            h1 { font-size: 28px; }
            .option { font-size: 16px; padding: 15px; }
            .result-type-badge { font-size: 80px; }
            .save-btn { width: 50px; height: 50px; font-size: 24px; bottom: 20px; right: 20px; }
        }
    </style>
</head>
<body>
    <!-- æ˜Ÿç©ºèƒŒæ™¯ -->
    <div class="stars" id="stars"></div>

    <div class="container">
        <!-- åŠ è½½é¡µé¢ -->
        <div id="loading" class="card" style="text-align: center;">
            <div style="font-size: 80px; margin: 30px 0;">ğŸƒ</div>
            <h2>æ­£åœ¨å”¤é†’é»‘æš—åŠ›é‡...</h2>
            <p style="margin-top: 20px; color: #ccc;">è¯·ç¨å€™ï¼Œä¸‡åœ£èŠ‚é­”æ³•å³å°†å¼€å¯</p>
        </div>

        <!-- ææƒ§çº§åˆ«é€‰æ‹© -->
        <div id="level-selection" class="card hidden">
            <h1>ğŸƒ ä¸‡åœ£èŠ‚ MBTI æµ‹è¯•</h1>
            <h2>é€‰æ‹©ä½ çš„æƒŠå“ç­‰çº§</h2>
            <p style="text-align: center; color: #F8A51C; margin-bottom: 20px;">âœ¨ ç²¾ç®€ç‰ˆ - åªéœ€5é“é¢˜ï¼Œå¿«é€Ÿå®Œæˆæµ‹è¯•ï¼</p>

            <div class="option" data-level="mild" onclick="selectLevel(this, 'mild')">
                <div style="font-size: 30px; margin-bottom: 10px;">ğŸŒ™</div>
                <strong>æ¸©å’Œæ¨¡å¼</strong>
                <p style="margin-top: 10px; color: #ccc;">é€‚åˆèƒ†å°é¬¼ï¼Œæ²¡æœ‰çªç„¶æƒŠå“</p>
            </div>

            <div class="option selected" data-level="normal" onclick="selectLevel(this, 'normal')">
                <div style="font-size: 30px; margin-bottom: 10px;">ğŸ‘»</div>
                <strong>æ ‡å‡†æ¨¡å¼</strong>
                <p style="margin-top: 10px; color: #ccc;">é€‚ä¸­çš„ææ€–ä½“éªŒï¼Œæœ‰è½»å¾®æƒŠå“</p>
            </div>

            <div class="option" data-level="extreme" onclick="selectLevel(this, 'extreme')">
                <div style="font-size: 30px; margin-bottom: 10px;">ğŸ’€</div>
                <strong>æé™æ¨¡å¼</strong>
                <p style="margin-top: 10px; color: #ccc;">ç»ˆæææ€–ä½“éªŒï¼Œé«˜èƒ½é¢„è­¦ï¼</p>
            </div>

            <button class="button" onclick="startTest()">
                ç¡®è®¤è¿›å…¥é»‘æš—ä¸–ç•Œ
            </button>
        </div>

        <!-- æµ‹è¯•é¢˜ç›® -->
        <div id="quiz" class="card hidden">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 id="question-number">é—®é¢˜ 1</h2>
                <div style="font-size: 14px; color: #F8A51C;" id="level-name">æ ‡å‡†æ¨¡å¼</div>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progress" style="width: 0%"></div>
            </div>
            <div class="progress-text" id="progress-text">0% å®Œæˆ</div>

            <div class="timer" id="timer">â±ï¸ 00:00</div>
            <div class="personality-hint" id="personality-hint">ğŸ’¡ æ­£åœ¨åˆ†æä½ çš„é€‰æ‹©å€¾å‘...</div>
            <div class="encouragement" id="encouragement">é€‰æ‹©ä½ çš„ç­”æ¡ˆï¼Œå¼€å§‹æ¢ç´¢ä½ çš„ä¸‡åœ£èŠ‚äººæ ¼ï¼</div>

            <h3 id="question-text" style="margin: 30px 0; font-size: 22px; line-height: 1.6;"></h3>

            <div id="options"></div>

            <button class="button hidden" id="next-btn" onclick="nextQuestion()">
                ä¸‹ä¸€é¢˜ â¡ï¸
            </button>
        </div>

        <!-- ç»“æœé¡µé¢ -->
        <div id="result" class="card hidden">
            <div class="result result-card-enhanced">
                <h2>ğŸŠ æµ‹è¯•å®Œæˆï¼ä½ çš„ä¸‡åœ£èŠ‚äººæ ¼æ˜¯</h2>
                <div class="result-type-badge" id="type-emoji">ğŸƒ</div>
                <h3 id="type-name" style="font-size: 36px; color: #F8A51C; margin: 20px 0;"></h3>
                <p id="type-description" style="font-size: 18px; line-height: 1.8; margin: 20px 0;"></p>

                <!-- æˆå°±ç³»ç»Ÿ -->
                <div id="achievements" style="margin: 20px 0;"></div>

                <div style="background: rgba(107, 29, 158, 0.2); padding: 20px; border-radius: 10px; margin: 30px 0;">
                    <h4 style="color: #F8A51C; margin-bottom: 15px;">ä½ çš„è¶…è‡ªç„¶ç‰¹å¾ï¼š</h4>
                    <ul id="traits" style="text-align: left; list-style: none;"></ul>
                </div>

                <!-- åˆ†äº«æŒ‰é’® -->
                <div class="share-buttons">
                    <button class="share-btn" onclick="shareToWeChat()">ğŸ“± å¾®ä¿¡åˆ†äº«</button>
                    <button class="share-btn" onclick="shareToQQ()">ğŸ’¬ QQåˆ†äº«</button>
                    <button class="share-btn" onclick="copyResult()">ğŸ“‹ å¤åˆ¶ç»“æœ</button>
                </div>

                <button class="button restart-btn" onclick="restart()">
                    ğŸ”„ å†æ¬¡æµ‹è¯•
                </button>
            </div>
        </div>

        <!-- ä¿å­˜ç»“æœæŒ‰é’® -->
        <button class="save-btn" id="save-btn" onclick="saveResult()" title="ä¿å­˜ç»“æœ">ğŸ’¾</button>

        <!-- æƒŠå“æŒ‡ç¤ºå™¨ -->
        <div id="scare-indicator" class="scare-indicator hidden">ğŸ‘» æƒŠå“å·²æ¿€æ´»</div>

        <!-- å£°éŸ³å¯è§†åŒ– -->
        <div id="sound-wave" class="sound-wave hidden">
            <span></span><span></span><span></span><span></span><span></span>
        </div>

        <!-- æƒŠå“ç­‰çº§æç¤º -->
        <div id="level-warning" class="level-warning hidden"></div>

        <!-- ä¸»é¢˜åˆ‡æ¢å™¨ -->
        <div id="theme-switcher" class="theme-switcher">
            <button class="theme-btn active" data-theme="halloween">ğŸƒ</button>
            <button class="theme-btn" data-theme="christmas">ğŸ„</button>
            <button class="theme-btn" data-theme="cyberpunk">ğŸ¤–</button>
            <button class="theme-btn" data-theme="ocean">ğŸŒŠ</button>
        </div>

        <!-- æŠ€èƒ½æ ‘ -->
        <div id="skill-tree" class="skill-tree hidden">
            <h3 style="color: #F8A51C; margin-bottom: 15px; text-align: center;">ğŸ’ ä¸‡åœ£èŠ‚æŠ€èƒ½</h3>
            <div id="skills-container"></div>
        </div>

        <!-- è£…å¤‡é¢æ¿ -->
        <div id="equipment-panel" class="equipment-panel hidden">
            <h3 style="color: #6b1d9e; margin-bottom: 15px; text-align: center;">ğŸ’ è™šæ‹Ÿè£…å¤‡</h3>
            <div id="equipment-container"></div>
        </div>

        <!-- æ¯æ—¥æŒ‘æˆ˜ -->
        <div id="daily-challenge" class="daily-challenge hidden">
            <div class="daily-challenge-title">ğŸ¯ æ¯æ—¥æŒ‘æˆ˜</div>
            <div id="daily-challenge-text" class="daily-challenge-text"></div>
            <div class="daily-challenge-reward">
                <span>ğŸ†</span>
                <span id="daily-reward">å¥–åŠ±æœªçŸ¥</span>
            </div>
        </div>

        <!-- æ’è¡Œæ¦œæŒ‰é’® -->
        <button id="leaderboard-btn" class="save-btn" style="bottom: 110px;" onclick="showLeaderboard()" title="æ’è¡Œæ¦œ">ğŸ†</button>
    </div>

    <script>
        // 5é“MBTIæµ‹è¯•é¢˜ç›®ï¼ˆç²¾ç®€ç‰ˆï¼‰
        const questions = [
            {
                text: "åœ¨ä¸‡åœ£èŠ‚æ´¾å¯¹ä¸Šï¼Œä½ æ›´å–œæ¬¢æˆä¸ºï¼Ÿ",
                options: [
                    { text: "A. å—æ¬¢è¿çš„ç„¦ç‚¹", value: "E" },
                    { text: "B. å¹•åç­–åˆ’è€…", value: "I" }
                ]
            },
            {
                text: "å½“ä½ é‡åˆ°ä¸€ä¸ªå¤æ‚çš„ä¸‡åœ£èŠ‚è£…é¥°æ—¶ï¼Œä½ ä¼šï¼Ÿ",
                options: [
                    { text: "A. æ³¨æ„ç»†èŠ‚å’Œå…·ä½“ä¿¡æ¯", value: "S" },
                    { text: "B. å…³æ³¨æ•´ä½“å°è±¡å’Œå¯èƒ½æ€§", value: "N" }
                ]
            },
            {
                text: "åšå†³å®šæ—¶ï¼Œä½ æ›´å€¾å‘äºï¼Ÿ",
                options: [
                    { text: "A. åŸºäºé€»è¾‘å’Œå®¢è§‚åˆ†æ", value: "T" },
                    { text: "B. è€ƒè™‘å¯¹ä»–äººçš„å½±å“", value: "F" }
                ]
            },
            {
                text: "ä½ æ›´å–œæ¬¢ï¼Ÿ",
                options: [
                    { text: "A. æœ‰è®¡åˆ’çš„å®‰æ’", value: "J" },
                    { text: "B. çµæ´»åº”å˜", value: "P" }
                ]
            },
            {
                text: "é¢å¯¹ä¸‡åœ£èŠ‚çš„æƒŠå–œï¼Œä½ æ›´å€¾å‘äºï¼Ÿ",
                options: [
                    { text: "A. æœŸå¾…ä¸å¾ˆå¤šäººä¸€èµ·äº’åŠ¨", value: "E" },
                    { text: "B. äº«å—å®‰é™çš„ç‹¬å¤„æ—¶å…‰", value: "I" }
                ]
            }
        ];

        // MBTIäººæ ¼ç±»å‹å®šä¹‰
        const personalities = {
            "INTJ": {
                name: "ä¸‡åœ£èŠ‚å»ºç­‘å¸ˆ",
                emoji: "ğŸ©",
                description: "ä½ æ˜¯é»‘æš—åŸå ¡çš„åˆ›é€ è€…ï¼Œæ‹¥æœ‰æˆ˜ç•¥çœ¼å…‰å’Œç‹¬ç«‹ç²¾ç¥ã€‚ä½ å–œæ¬¢æå‰è§„åˆ’æ¯ä¸€ä¸ªç»†èŠ‚ï¼Œåˆ›é€ å‡ºä»¤äººæƒŠå¹çš„ä¸‡åœ£èŠ‚ä½“éªŒã€‚",
                traits: ["æ·±è°‹è¿œè™‘", "ç‹¬ç«‹è‡ªä¸»", "è¿½æ±‚å®Œç¾", "ç¥ç§˜è«æµ‹"]
            },
            "INTP": {
                name: "å—ç“œå‘æ˜å®¶",
                emoji: "ğŸ§ª",
                description: "ä½ æ˜¯ä¸‡åœ£èŠ‚ç§‘æŠ€çš„å…ˆé©±ï¼Œå–œæ¬¢å‘æ˜å„ç§æ–°å¥‡çš„è£…ç½®å’Œç‰¹æ•ˆã€‚ä½ å¯¹æœªçŸ¥äº‹ç‰©å……æ»¡å¥½å¥‡ï¼Œæ€»èƒ½æƒ³å‡ºåˆ«äººæƒ³ä¸åˆ°çš„åˆ›æ„ã€‚",
                traits: ["åˆ›æ–°æ€ç»´", "ç†æ€§åˆ†æ", "ç‹¬ç«‹æ€è€ƒ", "è¿½æ±‚çœŸç†"]
            },
            "ENTJ": {
                name: "ææ€–ä¹‹ç‹",
                emoji: "ğŸ‘‘",
                description: "ä½ æ˜¯ä¸‡åœ£èŠ‚æ´¾å¯¹çš„å¤©ç”Ÿé¢†å¯¼è€…ï¼Œå…·æœ‰å¼ºå¤§çš„ç»„ç»‡èƒ½åŠ›å’Œè¿œè§ã€‚ä½ èƒ½è®©æ¯ä¸€ä¸ªä¸‡åœ£èŠ‚æ´»åŠ¨éƒ½æˆä¸ºéš¾å¿˜çš„ç››å…¸ã€‚",
                traits: ["å¤©ç”Ÿçš„é¢†å¯¼è€…", "é«˜æ•ˆæ‰§è¡Œ", "ç›®æ ‡å¯¼å‘", "é­…åŠ›åè¶³"]
            },
            "ENTP": {
                name: "æ¶ä½œå‰§å¤§å¸ˆ",
                emoji: "ğŸ­",
                description: "ä½ æ˜¯ä¸‡åœ£èŠ‚çš„çµé­‚äººç‰©ï¼Œæ€»èƒ½æƒ³å‡ºå‡ºäººæ„æ–™çš„åˆ›æ„å’Œæ¶ä½œå‰§ã€‚ä½ çš„å¹½é»˜æ„Ÿå’Œåˆ›æ–°èƒ½åŠ›è®©æ‰€æœ‰äººéƒ½å°è±¡æ·±åˆ»ã€‚",
                traits: ["å¯Œæœ‰åˆ›æ„", "å–„äºäº¤é™…", "çµæ´»åº”å˜", "å……æ»¡çƒ­æƒ…"]
            },
            "INFJ": {
                name: "ç²¾ç¥å¯¼å¸ˆ",
                emoji: "ğŸ”®",
                description: "ä½ æ˜¯ä¸‡åœ£èŠ‚çš„ç¥ç§˜å®ˆæŠ¤è€…ï¼Œèƒ½å¤Ÿæ´å¯Ÿä»–äººçš„å†…å¿ƒä¸–ç•Œã€‚ä½ åˆ›é€ çš„ç¯å¢ƒæ€»æ˜¯èƒ½è®©æ¯ä¸ªäººæ‰¾åˆ°å±äºè‡ªå·±çš„é‚£ä»½æ¸©æš–ã€‚",
                traits: ["å¯Œæœ‰æ´å¯ŸåŠ›", "ç†æƒ³ä¸»ä¹‰", "å–„è§£äººæ„", "ç¥ç§˜ä¼˜é›…"]
            },
            "INFP": {
                name: "æ¢¦å¹»è¯—äºº",
                emoji: "ğŸ¦‹",
                description: "ä½ æ˜¯ä¸‡åœ£èŠ‚çš„æµªæ¼«ä¸»ä¹‰è€…ï¼Œç”¨ç‹¬ç‰¹çš„è§†è§’çœ‹å¾…ä¸–ç•Œã€‚ä½ çš„åˆ›æ„å’ŒçœŸè¯šæ€»èƒ½è§¦åŠ¨äººå¿ƒï¼Œåˆ›é€ å‡ºæ¸©é¦¨çš„èŠ‚æ—¥æ°›å›´ã€‚",
                traits: ["å¯Œæœ‰æƒ³è±¡åŠ›", "çœŸè¯šå–„è‰¯", "ä»·å€¼è§‚å¼º", "è¿½æ±‚ç¾å¥½"]
            },
            "ENFJ": {
                name: "ä¸‡åœ£èŠ‚å¼•è·¯äºº",
                emoji: "ğŸ•Šï¸",
                description: "ä½ æ˜¯ä¸‡åœ£èŠ‚çš„æ­£èƒ½é‡ä¼ æ’­è€…ï¼Œèƒ½å¤Ÿæ¿€å‘æ¯ä¸ªäººå†…å¿ƒçš„å‹‡æ•¢å’Œå–„è‰¯ã€‚ä½ æ€»æ˜¯èƒ½è®©æœ€å†…å‘çš„äººä¹Ÿèƒ½äº«å—èŠ‚æ—¥çš„å¿«ä¹ã€‚",
                traits: ["å¤©ç”Ÿçš„é¼“èˆè€…", "å–„äºæ²Ÿé€š", "å…³çˆ±ä»–äºº", "å…·æœ‰é­…åŠ›"]
            },
            "ENFP": {
                name: "å¿«ä¹å¹½çµ",
                emoji: "ğŸˆ",
                description: "ä½ æ˜¯ä¸‡åœ£èŠ‚çš„å¼€å¿ƒæœï¼Œæ€»æ˜¯å……æ»¡æ´»åŠ›å’Œæ­£èƒ½é‡ã€‚ä½ çš„ä¹è§‚å’Œçƒ­æƒ…æ„ŸæŸ“ç€æ¯ä¸€ä¸ªäººï¼Œè®©ä¸‡åœ£èŠ‚å……æ»¡æ¬¢å£°ç¬‘è¯­ã€‚",
                traits: ["çƒ­æƒ…æ´‹æº¢", "ç¤¾äº¤è¾¾äºº", "åˆ›é€ åŠ›å¼º", "ç§¯æä¹è§‚"]
            },
            "ISTJ": {
                name: "ä¼ ç»Ÿå®ˆæŠ¤è€…",
                emoji: "ğŸ°",
                description: "ä½ æ˜¯ä¸‡åœ£èŠ‚ä¼ ç»Ÿçš„åšå®šå®ˆæŠ¤è€…ï¼Œä¸¥æ ¼éµå¾ªå¤è€çš„ä¹ ä¿—å’Œä»ªå¼ã€‚ä½ çš„å¯é å’Œç¨³é‡è®©ä¸‡åœ£èŠ‚åº†ç¥æ›´åŠ æœ‰åºå’Œæ¸©é¦¨ã€‚",
                traits: ["è´£ä»»æ‹…å½“", "å¿ è¯šå¯é ", "æ³¨é‡ä¼ ç»Ÿ", "ç»†è‡´è®¤çœŸ"]
            },
            "ISFJ": {
                name: "å®ˆæŠ¤å¤©ä½¿",
                emoji: "ğŸ›¡ï¸",
                description: "ä½ æ˜¯ä¸‡åœ£èŠ‚çš„å®ˆæŠ¤å¤©ä½¿ï¼Œé»˜é»˜å…³å¿ƒç€æ¯ä¸€ä¸ªäººçš„æ„Ÿå—ã€‚ä½ çš„æ¸©æš–å’Œä½“è´´è®©æ‰€æœ‰äººéƒ½èƒ½å®‰å¿ƒäº«å—èŠ‚æ—¥ã€‚",
                traits: ["æ¸©æš–ä½“è´´", "ä¹äºåŠ©äºº", "ä¿æŠ¤ä»–äºº", "é»˜é»˜å¥‰çŒ®"]
            },
            "ESTJ": {
                name: "åº†å…¸æ€»ç›‘",
                emoji: "ğŸª",
                description: "ä½ æ˜¯ä¸‡åœ£èŠ‚æ´»åŠ¨çš„å®Œç¾æ‰§è¡Œè€…ï¼Œæ‰€æœ‰ç»†èŠ‚éƒ½åœ¨ä½ çš„æŒæ§ä¹‹ä¸­ã€‚ä½ çš„ç»„ç»‡èƒ½åŠ›è®©æ¯ä¸€æ¬¡åº†ç¥éƒ½å®Œç¾æ— ç¼ºã€‚",
                traits: ["ç»„ç»‡èƒ½åŠ›å¼º", "é«˜æ•ˆæ‰§è¡Œ", "æ³¨é‡ç»“æœ", "å€¼å¾—ä¿¡èµ–"]
            },
            "ESFJ": {
                name: "èŠ‚æ—¥åè°ƒå‘˜",
                emoji: "ğŸŠ",
                description: "ä½ æ˜¯ä¸‡åœ£èŠ‚çš„å’Œè°ä½¿è€…ï¼Œæ€»èƒ½è®©æ‰€æœ‰äººéƒ½æ„Ÿåˆ°å—æ¬¢è¿å’Œè¢«å…³çˆ±ã€‚ä½ çš„ç¤¾äº¤å¤©èµ‹è®©æ¯ä¸€ä¸ªèšä¼šéƒ½å……æ»¡æ¸©æš–ã€‚",
                traits: ["å–„äºåè°ƒ", "å…³çˆ±ä»–äºº", "è¥é€ å’Œè°", "äººè§äººçˆ±"]
            },
            "ISTP": {
                name: "ç‰¹æ•ˆå·¥åŒ ",
                emoji: "âš™ï¸",
                description: "ä½ æ˜¯ä¸‡åœ£èŠ‚çš„æŠ€å·§å¤§å¸ˆï¼Œèƒ½å¤Ÿç”¨å·§æ‰‹åˆ›é€ æƒŠäººçš„ç‰¹æ•ˆã€‚ä½ çš„å†·é™å’Œç²¾å‡†è®©æ‰€æœ‰è£…ç½®éƒ½å®Œç¾è¿è¡Œã€‚",
                traits: ["åŠ¨æ‰‹èƒ½åŠ›å¼º", "å†·é™ç†æ€§", "é€‚åº”æ€§å¼º", "è§£å†³é—®é¢˜"]
            },
            "ISFP": {
                name: "è‰ºæœ¯å®¶å¹½çµ",
                emoji: "ğŸ¨",
                description: "ä½ æ˜¯ä¸‡åœ£èŠ‚çš„ç¾å­¦å¤§å¸ˆï¼Œç”¨è‰ºæœ¯å®¶çš„çœ¼å…‰æ‰“é€ æ¯ä¸€ä¸ªç»†èŠ‚ã€‚ä½ çš„åˆ›æ„å’Œç¾æ„Ÿè®©ä¸‡åœ£èŠ‚å……æ»¡äº†ç‹¬ç‰¹çš„é­…åŠ›ã€‚",
                traits: ["è‰ºæœ¯å¤©èµ‹", "å®¡ç¾ç‹¬ç‰¹", "æ¸©æŸ”æ•æ„Ÿ", "åˆ›é€ åŠ›å¼º"]
            },
            "ESTP": {
                name: "å†’é™©å®¶",
                emoji: "âš¡",
                description: "ä½ æ˜¯ä¸‡åœ£èŠ‚çš„è¡ŒåŠ¨æ´¾ï¼Œæ€»æ˜¯å……æ»¡æ´»åŠ›å’Œå†’é™©ç²¾ç¥ã€‚ä½ çš„å‹‡æ•¢å’Œæœæ–­è®©æ¯ä¸€ä¸ªæ—¶åˆ»éƒ½å……æ»¡åˆºæ¿€ã€‚",
                traits: ["å‹‡æ•¢æœæ–­", "å……æ»¡æ´»åŠ›", "é€‚åº”åŠ›å¼º", "äº«å—å½“ä¸‹"]
            },
            "ESFP": {
                name: "å¼€å¿ƒæœ",
                emoji: "ğŸ‰",
                description: "ä½ æ˜¯ä¸‡åœ£èŠ‚çš„æ¬¢ä¹åˆ¶é€ æœºï¼Œæ€»æ˜¯èƒ½ç”¨ä½ çš„çƒ­æƒ…å’Œæ´»åŠ›ç‚¹ç‡ƒå…¨åœºã€‚ä½ è®©æ¯ä¸€ä¸ªä¸‡åœ£èŠ‚éƒ½å……æ»¡æ¬¢å£°ç¬‘è¯­ã€‚",
                traits: ["çƒ­æƒ…å¼€æœ—", "æ„ŸæŸ“åŠ›å¼º", "ç¤¾äº¤è¾¾äºº", "æ´»åœ¨å½“ä¸‹"]
            }
        };

        let currentQuestion = 0;
        let answers = [];
        let selectedLevel = 'normal';
        let startTime = null;
        let timerInterval = null;
        let totalTime = 0;
        let achievements = [];
        let scareActive = false;
        let scaryElementsInterval = null;

        // æ–°å¢ç³»ç»Ÿå˜é‡
        let currentTheme = 'halloween';
        let skills = [];
        let equipment = {};
        let npcMessagesShown = [];
        let randomEventsTriggered = [];
        let currentWeather = null;
        let weatherInterval = null;
        let currentMiniGame = null;
        let gameStats = {
            gamesPlayed: 0,
            perfectAnswers: 0,
            hintsUsed: 0,
            fastestTime: null
        };

        // åˆ›å»ºæ˜Ÿç©ºèƒŒæ™¯
        function createStars() {
            const starsContainer = document.getElementById('stars');
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                starsContainer.appendChild(star);
            }
        }

        // é€‰æ‹©ææƒ§çº§åˆ«
        function selectLevel(element, level) {
            selectedLevel = level;
            document.querySelectorAll('#level-selection .option').forEach(opt => {
                opt.classList.remove('selected');
            });
            element.classList.add('selected');
        }

        // å¼€å§‹æµ‹è¯•
        function startTest() {
            document.getElementById('loading').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('level-selection').classList.add('hidden');
                document.getElementById('quiz').classList.remove('hidden');
                showQuestion();
            }, 1500);
        }

        // æ˜¾ç¤ºé—®é¢˜
        function showQuestion() {
            const q = questions[currentQuestion];
            const progress = (currentQuestion / questions.length) * 100;

            document.getElementById('question-number').textContent = `é—®é¢˜ ${currentQuestion + 1} / ${questions.length}`;
            document.getElementById('question-text').textContent = q.text;
            document.getElementById('progress').style.width = progress + '%';
            document.getElementById('progress-text').textContent = `${Math.round(progress)}% å®Œæˆ`;
            document.getElementById('level-name').textContent = selectedLevel === 'mild' ? 'æ¸©å’Œæ¨¡å¼' :
                selectedLevel === 'normal' ? 'æ ‡å‡†æ¨¡å¼' : 'æé™æ¨¡å¼';

            // æ›´æ–°äººæ ¼å€¾å‘æç¤º
            updatePersonalityHint();

            // å¯åŠ¨è®¡æ—¶å™¨
            startTimer();

            // æ›´æ–°é¼“åŠ±æ–‡å­—
            updateEncouragement();

            // æ¿€æ´»æƒŠå“ç³»ç»Ÿï¼ˆä»…åœ¨éæ¸©å’Œæ¨¡å¼ï¼‰
            if (!scareActive && selectedLevel !== 'mild') {
                activateScareMode();
                showLevelWarning();
            }

            // æ¸©å’Œæ¨¡å¼ï¼šå¶å°”å‡ºç°å°ææ€–å…ƒç´ 
            if (selectedLevel === 'mild' && Math.random() < 0.3) {
                setTimeout(() => {
                    createRandomScaryElement();
                }, 1000);
            }

            const optionsContainer = document.getElementById('options');
            optionsContainer.innerHTML = '';
            answers[currentQuestion] = null;

            q.options.forEach((option, index) => {
                const div = document.createElement('div');
                div.className = 'option';
                div.textContent = option.text;
                div.onclick = (e) => {
                    selectAnswer(index, option.value);
                    createClickEffect(e);
                    createParticles(e.target);
                    triggerAnswerEffects(div);
                };
                optionsContainer.appendChild(div);
            });

            // éšæœºè§¦å‘ç‚«é…·èƒŒæ™¯ç‰¹æ•ˆ
            if (Math.random() < 0.4) {
                setTimeout(() => triggerRandomCoolEffect(), 1000);
            }

            document.getElementById('next-btn').classList.add('hidden');
        }

        // å¯åŠ¨è®¡æ—¶å™¨
        function startTimer() {
            if (!startTime) {
                startTime = Date.now();
            }
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            timerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                document.getElementById('timer').textContent =
                    `â±ï¸ ${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            }, 1000);
        }

        // æ›´æ–°äººæ ¼å€¾å‘æç¤º
        function updatePersonalityHint() {
            const counts = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
            answers.forEach(a => {
                if (a) counts[a]++;
            });

            let hint = '';
            if (currentQuestion === 0) {
                hint = 'ğŸ’¡ æ­£åœ¨åˆ†æä½ çš„ç¤¾äº¤åå¥½...';
            } else if (currentQuestion === 1) {
                hint = 'ğŸ” ä½ çš„ä¿¡æ¯å¤„ç†æ–¹å¼æ˜¯...';
            } else if (currentQuestion === 2) {
                hint = 'ğŸ§  å†³ç­–é£æ ¼æ­£åœ¨æ˜¾ç°...';
            } else if (currentQuestion === 3) {
                hint = 'ğŸ“‹ ä½ åçˆ±çš„ç”Ÿæ´»æ–¹å¼...';
            } else if (currentQuestion === 4) {
                hint = 'ğŸŒŸ ä½ çš„ä¸‡åœ£èŠ‚äººæ ¼å³å°†æ­æ™“ï¼';
            }

            const personalities = [
                { letter: 'E', name: 'å¤–å‘å‹', emoji: 'ğŸ‰', desc: 'å–œæ¬¢ç¤¾äº¤å’Œäº’åŠ¨' },
                { letter: 'I', name: 'å†…å‘å‹', emoji: 'ğŸŒ™', desc: 'åçˆ±æ·±åº¦æ€è€ƒ' },
                { letter: 'S', name: 'æ„Ÿè§‰å‹', emoji: 'ğŸ”', desc: 'æ³¨é‡å®é™…ç»†èŠ‚' },
                { letter: 'N', name: 'ç›´è§‰å‹', emoji: 'ğŸ’¡', desc: 'å¯Œæœ‰æƒ³è±¡åŠ›' },
                { letter: 'T', name: 'æ€ç»´å‹', emoji: 'ğŸ§ ', desc: 'ç†æ€§åˆ†æ' },
                { letter: 'F', name: 'æƒ…æ„Ÿå‹', emoji: 'â¤ï¸', desc: 'é‡è§†å’Œè°' },
                { letter: 'J', name: 'åˆ¤æ–­å‹', emoji: 'ğŸ“‹', desc: 'å–œæ¬¢è®¡åˆ’' },
                { letter: 'P', name: 'çŸ¥è§‰å‹', emoji: 'ğŸ¯', desc: 'çµæ´»åº”å˜' }
            ];

            const maxCount = Math.max(...Object.values(counts));
            if (maxCount > 0) {
                const dominant = Object.keys(counts).find(key => counts[key] === maxCount);
                const personality = personalities.find(p => p.letter === dominant);
                hint += ` å½“å‰å€¾å‘: ${personality.emoji} ${personality.name}`;
            }

            document.getElementById('personality-hint').textContent = hint;
        }

        // æ›´æ–°é¼“åŠ±æ–‡å­—
        function updateEncouragement() {
            const encouragements = [
                'é€‰æ‹©ä½ çš„ç­”æ¡ˆï¼Œå¼€å§‹æ¢ç´¢ä½ çš„ä¸‡åœ£èŠ‚äººæ ¼ï¼',
                'æ¯ä¸€ä¸ªé€‰æ‹©éƒ½æ­ç¤ºä½ çš„çœŸå®æœ¬è´¨ âœ¨',
                'ä¸‡åœ£èŠ‚çš„é­”æ³•æ­£åœ¨ä½ çš„é€‰æ‹©ä¸­æ˜¾ç° ğŸ‘»',
                'ä½ çš„äººæ ¼å¯†ç å³å°†è§£é” ğŸ­',
                'ç»§ç»­å‰è¿›ï¼ŒçœŸç›¸å³å°†æ­æ™“ ğŸ”®'
            ];
            const randomEncouragement = encouragements[Math.floor(Math.random() * encouragements.length)];
            document.getElementById('encouragement').textContent = randomEncouragement;
        }

        // åˆ›å»ºç‚¹å‡»ç‰¹æ•ˆ
        function createClickEffect(event) {
            const effect = document.createElement('div');
            effect.className = 'click-effect';
            effect.style.left = event.clientX + 'px';
            effect.style.top = event.clientY + 'px';
            effect.style.color = '#F8A51C';
            effect.textContent = 'âœ¨';
            effect.style.fontSize = '30px';
            document.body.appendChild(effect);

            setTimeout(() => effect.remove(), 500);
        }

        // åˆ›å»ºç²’å­æ•ˆæœ
        function createParticles(element) {
            const rect = element.getBoundingClientRect();
            const colors = ['#F8A51C', '#F25C5C', '#6b1d9e', '#9d4edd'];

            for (let i = 0; i < 10; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                particle.style.left = rect.left + rect.width / 2 + 'px';
                particle.style.top = rect.top + rect.height / 2 + 'px';

                const dx = (Math.random() - 0.5) * 200;
                const dy = (Math.random() - 0.5) * 200;
                particle.style.setProperty('--dx', dx + 'px');
                particle.style.setProperty('--dy', dy + 'px');

                document.body.appendChild(particle);

                setTimeout(() => particle.remove(), 1000);
            }
        }

        // ==================== æƒŠå“ç³»ç»Ÿ ====================

        // æ¿€æ´»æƒŠå“æ¨¡å¼
        function activateScareMode() {
            scareActive = true;
            document.getElementById('scare-indicator').classList.remove('hidden');
            document.getElementById('sound-wave').classList.remove('hidden');

            if (selectedLevel === 'extreme') {
                // æé™æ¨¡å¼ï¼šé«˜é¢‘ç‡æƒŠå“
                scaryElementsInterval = setInterval(() => {
                    if (Math.random() < 0.7) {
                        triggerRandomScare();
                    }
                }, 8000);
            } else if (selectedLevel === 'normal') {
                // æ ‡å‡†æ¨¡å¼ï¼šä¸­ç­‰é¢‘ç‡æƒŠå“
                scaryElementsInterval = setInterval(() => {
                    if (Math.random() < 0.5) {
                        triggerRandomScare();
                    }
                }, 15000);
            } else {
                // æ¸©å’Œæ¨¡å¼ï¼šä½é¢‘ç‡æƒŠå“
                scaryElementsInterval = setInterval(() => {
                    if (Math.random() < 0.3) {
                        triggerRandomScare();
                    }
                }, 25000);
            }
        }

        // è§¦å‘éšæœºæƒŠå“
        function triggerRandomScare() {
            const scares = ['ghost', 'bat', 'pumpkin', 'spider', 'willowisp', 'scaryMsg', 'screenShake', 'screenFlash'];
            const randomScare = scares[Math.floor(Math.random() * scares.length)];

            switch(randomScare) {
                case 'ghost': createGhost(); break;
                case 'bat': createBat(); break;
                case 'pumpkin': createPumpkinGlow(); break;
                case 'spider': createSpider(); break;
                case 'willowisp': createWillOWisp(); break;
                case 'scaryMsg': showScaryMessage(); break;
                case 'screenShake': screenShake(); break;
                case 'screenFlash': screenFlash(); break;
            }

            // æ’­æ”¾æƒŠå“éŸ³æ•ˆ
            playScareSound();
        }

        // åˆ›å»ºå¹½çµ
        function createGhost() {
            const ghost = document.createElement('div');
            ghost.className = 'ghost-walk';
            ghost.textContent = 'ğŸ‘»';
            document.body.appendChild(ghost);

            setTimeout(() => ghost.remove(), 5000);
        }

        // åˆ›å»ºè™è 
        function createBat() {
            const bat = document.createElement('div');
            bat.className = 'bat-fly';
            bat.textContent = 'ğŸ¦‡';
            document.body.appendChild(bat);

            setTimeout(() => bat.remove(), 3000);
        }

        // åˆ›å»ºå—ç“œç¯é—ªçƒ
        function createPumpkinGlow() {
            const pumpkin = document.createElement('div');
            pumpkin.className = 'pumpkin-glow';
            pumpkin.style.left = '50%';
            pumpkin.style.top = '50%';
            pumpkin.style.transform = 'translate(-50%, -50%)';
            pumpkin.textContent = 'ğŸƒ';
            document.body.appendChild(pumpkin);

            setTimeout(() => pumpkin.remove(), 500);
        }

        // åˆ›å»ºæ‘‡æ‘†èœ˜è››
        function createSpider() {
            const spider = document.createElement('div');
            spider.className = 'spider-swing';
            spider.textContent = 'ğŸ•·ï¸';
            document.body.appendChild(spider);

            setTimeout(() => spider.remove(), 3000);
        }

        // åˆ›å»ºé¬¼ç«
        function createWillOWisp() {
            const will = document.createElement('div');
            will.className = 'will-o-wisp';
            will.style.left = Math.random() * 80 + 10 + '%';
            will.style.bottom = Math.random() * 50 + 10 + '%';
            document.body.appendChild(will);

            setTimeout(() => will.remove(), 4000);
        }

        // æ˜¾ç¤ºææ€–æ¶ˆæ¯
        function showScaryMessage() {
            const messages = [
                'ğŸ‘» ä½ ä¸æ˜¯ä¸€ä¸ªäºº...',
                'ğŸ•¯ï¸ é»‘æš—ä¸­æœ‰ä»€ä¹ˆåœ¨çœ‹ç€ä½ ',
                'ğŸ¦‡ è™è å·²ç»è‹é†’',
                'ğŸƒ å—ç“œåœ¨å¯¹ä½ å¾®ç¬‘',
                'ğŸ‘ï¸ ä½ è¢«ç›‘è§†ç€...',
                'ğŸ’€ æ­»ç¥åœ¨é è¿‘',
                'ğŸŒ™ æœˆäº®è§è¯äº†ä¸€åˆ‡',
                'ğŸ”® çœŸç›¸å³å°†æ­æ™“'
            ];
            const message = messages[Math.floor(Math.random() * messages.length)];

            const msg = document.createElement('div');
            msg.className = 'scare-msg';
            msg.textContent = message;
            document.body.appendChild(msg);

            setTimeout(() => msg.remove(), 1500);
        }

        // å±å¹•éœ‡åŠ¨
        function screenShake() {
            document.body.classList.add('screen-shake');
            setTimeout(() => {
                document.body.classList.remove('screen-shake');
            }, 300);
        }

        // å±å¹•é—ªçƒ
        function screenFlash() {
            document.body.classList.add('screen-flash');
            setTimeout(() => {
                document.body.classList.remove('screen-flash');
            }, 200);
        }

        // æ˜¾ç¤ºæƒŠå“ç­‰çº§æç¤º
        function showLevelWarning() {
            const warning = document.getElementById('level-warning');
            if (selectedLevel === 'extreme') {
                warning.textContent = 'ğŸ’€ æé™æ¨¡å¼å·²æ¿€æ´» - åšå¥½å¿ƒç†å‡†å¤‡ï¼';
            } else if (selectedLevel === 'normal') {
                warning.textContent = 'ğŸ‘» æ ‡å‡†æ¨¡å¼ - æƒŠå“å³å°†å¼€å§‹';
            } else {
                warning.textContent = 'ğŸŒ™ æ¸©å’Œæ¨¡å¼ - å®‰å…¨ä½“éªŒ';
            }
            warning.classList.remove('hidden');

            setTimeout(() => {
                warning.classList.add('hidden');
            }, 3000);
        }

        // æ’­æ”¾æƒŠå“éŸ³æ•ˆï¼ˆä½¿ç”¨Web Audio APIï¼‰
        function playScareSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                if (selectedLevel === 'extreme') {
                    // æé™æ¨¡å¼ï¼šä½æ²‰çš„ææ€–éŸ³æ•ˆ
                    oscillator.frequency.setValueAtTime(80, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(40, audioContext.currentTime + 0.1);
                } else {
                    // æ­£å¸¸æ¨¡å¼ï¼šè½»å¾®éŸ³æ•ˆ
                    oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(150, audioContext.currentTime + 0.1);
                }

                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);

                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.1);
            } catch (e) {
                console.log('éŸ³æ•ˆæ’­æ”¾å¤±è´¥:', e);
            }
        }

        // åˆ›å»ºéšæœºææ€–å…ƒç´ 
        function createRandomScaryElement() {
            const scaryElements = ['ğŸƒ', 'ğŸ‘»', 'ğŸ¦‡', 'ğŸ•·ï¸', 'ğŸ’€', 'ğŸ•¯ï¸'];
            const element = document.createElement('div');
            element.className = 'scary-element';
            element.textContent = scaryElements[Math.floor(Math.random() * scaryElements.length)];
            element.style.left = Math.random() * window.innerWidth + 'px';
            element.style.top = Math.random() * window.innerHeight + 'px';
            document.body.appendChild(element);

            setTimeout(() => element.remove(), 300);
        }

        // ==================== ç‚«é…·ç‰¹æ•ˆç³»ç»Ÿ ====================

        // åˆ›å»ºå½©è™¹æµå…‰
        function createRainbowStream() {
            const stream = document.createElement('div');
            stream.className = 'rainbow-stream';
            stream.style.left = Math.random() * 100 + '%';
            document.body.appendChild(stream);

            setTimeout(() => stream.remove(), 3000);
        }

        // åˆ›å»ºé­”æ³•é˜µ
        function createMagicCircle() {
            const circle = document.createElement('div');
            circle.className = 'magic-circle';
            circle.style.left = '50%';
            circle.style.top = '50%';
            circle.style.transform = 'translate(-50%, -50%)';
            document.body.appendChild(circle);

            setTimeout(() => circle.remove(), 5000);
        }

        // é›·ç”µæ•ˆæœ
        function createLightning() {
            const bolt = document.createElement('div');
            bolt.className = 'lightning-bolt';
            bolt.style.left = Math.random() * 100 + '%';
            document.body.appendChild(bolt);

            setTimeout(() => bolt.remove(), 200);
        }

        // èƒ½é‡æ³¢
        function createEnergyWave() {
            const wave = document.createElement('div');
            wave.className = 'energy-wave';
            document.body.appendChild(wave);

            setTimeout(() => wave.remove(), 1500);
        }

        // çƒŸèŠ±çˆ†ç‚¸
        function createFirework(x, y) {
            const colors = ['#F8A51C', '#F25C5C', '#6b1d9e', '#9d4edd', '#00ff00', '#00ffff'];
            const firework = document.createElement('div');
            firework.className = 'firework';
            firework.style.left = x + 'px';
            firework.style.top = y + 'px';
            firework.style.color = colors[Math.floor(Math.random() * colors.length)];
            document.body.appendChild(firework);

            setTimeout(() => firework.remove(), 1000);
        }

        // åˆ›å»ºæµ®ç©ºæ–‡å­—
        function createFloatingText(text, x, y) {
            const floating = document.createElement('div');
            floating.className = 'floating-text';
            floating.textContent = text;
            floating.style.left = x + 'px';
            floating.style.top = y + 'px';
            floating.style.color = '#F8A51C';
            document.body.appendChild(floating);

            setTimeout(() => floating.remove(), 2000);
        }

        // é»‘æ´æ•ˆæœ
        function createBlackHole() {
            const blackHole = document.createElement('div');
            blackHole.className = 'black-hole';
            blackHole.style.left = '50%';
            blackHole.style.top = '50%';
            blackHole.style.transform = 'translate(-50%, -50%)';
            document.body.appendChild(blackHole);

            setTimeout(() => blackHole.remove(), 3000);
        }

        // æå…‰æ•ˆæœ
        function createAurora() {
            const aurora = document.createElement('div');
            aurora.className = 'aurora';
            aurora.style.left = '-50%';
            document.body.appendChild(aurora);

            setTimeout(() => aurora.remove(), 8000);
        }

        // å…¨å±éœ‡åŠ¨ï¼ˆå¢å¼ºç‰ˆï¼‰
        function megaShake() {
            document.body.classList.add('mega-shake');
            setTimeout(() => {
                document.body.classList.remove('mega-shake');
            }, 500);
        }

        // ç‚«é…·æç¤ºæ¡†
        function showMegaMessage(text) {
            const msg = document.createElement('div');
            msg.className = 'mega-msg';
            msg.textContent = text;
            document.body.appendChild(msg);

            setTimeout(() => msg.remove(), 2000);
        }

        // 3Dæ—‹è½¬ç«‹æ–¹ä½“
        function createCube() {
            const cube = document.createElement('div');
            cube.className = 'cube';
            cube.style.left = '50%';
            cube.style.top = '50%';
            cube.style.transform = 'translate(-50%, -50%)';

            // åˆ›å»º6ä¸ªé¢
            for (let i = 0; i < 6; i++) {
                const face = document.createElement('div');
                face.className = 'cube-face';
                cube.appendChild(face);
            }

            document.body.appendChild(cube);

            setTimeout(() => cube.remove(), 4000);
        }

        // ä¼ é€é—¨
        function createPortal() {
            const portal = document.createElement('div');
            portal.className = 'portal';
            portal.style.left = '50%';
            portal.style.top = '50%';
            portal.style.transform = 'translate(-50%, -50%)';
            document.body.appendChild(portal);

            setTimeout(() => portal.remove(), 3000);
        }

        // å…¨æ¯æŠ•å½±æ–‡å­—
        function createHologramText(text) {
            const hologram = document.createElement('div');
            hologram.className = 'hologram-text';
            hologram.textContent = text;
            hologram.style.left = '50%';
            hologram.style.top = '30%';
            hologram.style.transform = 'translate(-50%, -50%)';
            document.body.appendChild(hologram);

            setTimeout(() => hologram.remove(), 2000);
        }

        // æ—¶é—´å‡é€Ÿæ•ˆæœ
        function timeSlowEffect() {
            document.body.classList.add('time-slow');
            setTimeout(() => {
                document.body.classList.remove('time-slow');
            }, 2000);
        }

        // åˆ›å»ºå…¨æ¯æŠ•å½±ç‰¹æ•ˆ
        function createHologramEffect() {
            const hologram = document.createElement('div');
            hologram.className = 'hologram-effect';
            hologram.style.left = Math.random() * window.innerWidth + 'px';
            hologram.style.top = Math.random() * window.innerHeight + 'px';
            hologram.textContent = 'ğŸ‘ï¸';
            hologram.style.fontSize = '100px';
            document.body.appendChild(hologram);

            setTimeout(() => hologram.remove(), 2000);
        }

        // éšæœºè§¦å‘ç‚«é…·ç‰¹æ•ˆ
        function triggerRandomCoolEffect() {
            const effects = [
                'rainbow', 'magic', 'lightning', 'energy', 'firework',
                'floatingText', 'blackHole', 'aurora', 'cube', 'portal',
                'hologram', 'timeSlow'
            ];
            const randomEffect = effects[Math.floor(Math.random() * effects.length)];

            switch(randomEffect) {
                case 'rainbow': createRainbowStream(); break;
                case 'magic': createMagicCircle(); break;
                case 'lightning': createLightning(); break;
                case 'energy': createEnergyWave(); break;
                case 'firework':
                    createFirework(Math.random() * window.innerWidth, Math.random() * window.innerHeight);
                    break;
                case 'floatingText':
                    const texts = ['âœ¨', 'ğŸŒŸ', 'ğŸ’«', 'â­', 'ğŸ¯'];
                    createFloatingText(texts[Math.floor(Math.random() * texts.length)],
                        Math.random() * window.innerWidth, Math.random() * window.innerHeight);
                    break;
                case 'blackHole': createBlackHole(); break;
                case 'aurora': createAurora(); break;
                case 'cube': createCube(); break;
                case 'portal': createPortal(); break;
                case 'hologram': createHologramEffect(); break;
                case 'timeSlow': timeSlowEffect(); break;
            }
        }

        // ç­”é¢˜ç‰¹æ•ˆåˆé›†
        function triggerAnswerEffects(element) {
            const rect = element.getBoundingClientRect();
            const x = rect.left + rect.width / 2;
            const y = rect.top + rect.height / 2;

            // åˆ›å»ºçƒŸèŠ±
            createFirework(x, y);

            // åˆ›å»ºèƒ½é‡æ³¢
            createEnergyWave();

            // åˆ›å»ºæµ®ç©ºæ–‡å­—
            const confirmTexts = ['âœ“', 'âœ¨', 'ğŸ¯', 'ğŸ’«'];
            createFloatingText(confirmTexts[Math.floor(Math.random() * confirmTexts.length)], x, y);

            // éšæœºç‚«é…·ç‰¹æ•ˆ
            if (Math.random() < 0.5) {
                triggerRandomCoolEffect();
            }
        }

        // é—®é¢˜åˆ‡æ¢ç‰¹æ•ˆ
        function triggerQuestionTransition() {
            // å½©è™¹æµå…‰
            for (let i = 0; i < 3; i++) {
                setTimeout(() => createRainbowStream(), i * 200);
            }

            // é­”æ³•é˜µ
            createMagicCircle();

            // å…¨æ¯æŠ•å½±æ–‡å­—
            setTimeout(() => {
                createHologramText('ä¸‹ä¸€é¡µ');
            }, 500);
        }

        // å®Œæˆæµ‹è¯•ç‰¹æ•ˆåˆé›†
        function triggerCompletionEffects() {
            // å¤§é‡çƒŸèŠ±
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    createFirework(
                        Math.random() * window.innerWidth,
                        Math.random() * window.innerHeight
                    );
                }, i * 100);
            }

            // å¤šä¸ªé­”æ³•é˜µ
            setTimeout(createMagicCircle, 200);
            setTimeout(createMagicCircle, 600);
            setTimeout(createMagicCircle, 1000);

            // ä¼ é€é—¨
            setTimeout(createPortal, 300);

            // é»‘æ´
            setTimeout(createBlackHole, 500);

            // æå…‰
            setTimeout(createAurora, 800);

            // å…¨æ¯æŠ•å½±æ–‡å­—
            setTimeout(() => createHologramText('æµ‹è¯•å®Œæˆï¼'), 400);

            // é›·ç”µ
            setTimeout(() => {
                for (let i = 0; i < 5; i++) {
                    setTimeout(createLightning, i * 150);
                }
            }, 600);

            // å…¨å±éœ‡åŠ¨
            setTimeout(megaShake, 1000);

            // ç‚«é…·æç¤ºæ¡†
            setTimeout(() => {
                showMegaMessage('ğŸ‰ ä¸‡åœ£èŠ‚äººæ ¼å·²è§£é”ï¼');
            }, 1200);
        }

        // ==================== æ–°åŠŸèƒ½ç³»ç»Ÿå®ç° ====================

        // 1. ä¸»é¢˜åˆ‡æ¢ç³»ç»Ÿ
        function initThemeSystem() {
            const themeButtons = document.querySelectorAll('.theme-btn');
            themeButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const theme = btn.dataset.theme;
                    switchTheme(theme);
                    themeButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                });
            });
        }

        function switchTheme(theme) {
            currentTheme = theme;
            const body = document.body;
            body.className = body.className.replace(/theme-\w+/, '');
            body.classList.add(`theme-${theme}`);

            // ä¸»é¢˜å¯¹åº”çš„å¤©æ°”
            if (theme === 'christmas') {
                startWeather('snow');
            } else if (theme === 'ocean') {
                startWeather('rain');
            } else if (theme === 'cyberpunk') {
                startWeather('fog');
            } else {
                stopWeather();
            }

            showNpcMessage(`åˆ‡æ¢åˆ°${getThemeName(theme)}ä¸»é¢˜ï¼`);
        }

        function getThemeName(theme) {
            const names = {
                halloween: 'ä¸‡åœ£èŠ‚',
                christmas: 'åœ£è¯èŠ‚',
                cyberpunk: 'èµ›åšæœ‹å…‹',
                ocean: 'æ·±æµ·'
            };
            return names[theme] || theme;
        }

        // 2. æŠ€èƒ½ç³»ç»Ÿ
        function initSkillSystem() {
            const skillTree = document.getElementById('skill-tree');
            skillTree.classList.remove('hidden');

            const defaultSkills = [
                { id: 1, name: 'å¿«é€Ÿæ€è€ƒ', icon: 'âš¡', level: 0, maxLevel: 3 },
                { id: 2, name: 'ç›´è§‰æ´å¯Ÿ', icon: 'ğŸ‘ï¸', level: 0, maxLevel: 3 },
                { id: 3, name: 'ç¤¾äº¤é­…åŠ›', icon: 'âœ¨', level: 0, maxLevel: 3 },
                { id: 4, name: 'é€»è¾‘åˆ†æ', icon: 'ğŸ§ ', level: 0, maxLevel: 3 },
                { id: 5, name: 'æƒ…ç»ªæ„ŸçŸ¥', icon: 'â¤ï¸', level: 0, maxLevel: 3 }
            ];

            skills = defaultSkills;
            updateSkillDisplay();
        }

        function updateSkillDisplay() {
            const container = document.getElementById('skills-container');
            container.innerHTML = '';
            skills.forEach(skill => {
                const div = document.createElement('div');
                div.className = `skill-item ${skill.level > 0 ? 'earned' : ''}`;
                div.innerHTML = `
                    <span class="skill-icon">${skill.icon}</span>
                    <span class="skill-name">${skill.name}</span>
                    <span class="skill-level">${skill.level}/${skill.maxLevel}</span>
                `;
                container.appendChild(div);
            });
        }

        function addSkillExperience(skillType) {
            const skill = skills.find(s => s.name.includes(skillType));
            if (skill && skill.level < skill.maxLevel) {
                skill.level++;
                updateSkillDisplay();
                showNpcMessage(`ğŸ’ æŠ€èƒ½æå‡ï¼${skill.name} è¾¾åˆ° Lv.${skill.level}`);
            }
        }

        // 3. è£…å¤‡ç³»ç»Ÿ
        function initEquipmentSystem() {
            const equipmentPanel = document.getElementById('equipment-panel');
            equipmentPanel.classList.remove('hidden');

            equipment = {
                hat: null,
                cloak: null,
                staff: null,
                shoes: null
            };
            updateEquipmentDisplay();
        }

        function updateEquipmentDisplay() {
            const container = document.getElementById('equipment-container');
            container.innerHTML = '';

            const slots = [
                { key: 'hat', name: 'å¸½å­', icon: 'ğŸ©' },
                { key: 'cloak', name: 'æ–—ç¯·', icon: 'ğŸ¦‡' },
                { key: 'staff', name: 'æ³•æ–', icon: 'ğŸ”®' },
                { key: 'shoes', name: 'é´å­', icon: 'ğŸ¥¾' }
            ];

            slots.forEach(slot => {
                const div = document.createElement('div');
                div.className = `equipment-slot ${equipment[slot.key] ? 'filled' : ''}`;
                div.innerHTML = `
                    <span class="equipment-icon">${equipment[slot.key]?.icon || slot.icon}</span>
                    <div class="equipment-info">
                        <div class="equipment-name">${equipment[slot.key]?.name || slot.name}</div>
                        <div class="equipment-bonus">${equipment[slot.key]?.bonus || ''}</div>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function equipItem(item) {
            if (!equipment[item.slot]) {
                equipment[item.slot] = item;
                updateEquipmentDisplay();
                showNpcMessage(`ğŸ’ è·å¾—è£…å¤‡ï¼š${item.name}ï¼`);
                return true;
            }
            return false;
        }

        // 4. NPCå¯¹è¯ç³»ç»Ÿ
        function showNpcMessage(message) {
            const dialog = document.createElement('div');
            dialog.className = 'npc-dialog';
            const avatars = ['ğŸƒ', 'ğŸ‘»', 'ğŸ¦‡', 'ğŸ•·ï¸', 'ğŸ§™'];
            const avatar = avatars[Math.floor(Math.random() * avatars.length)];

            dialog.innerHTML = `
                <span class="npc-avatar">${avatar}</span>
                <div style="padding-left: 40px;">${message}</div>
            `;
            document.body.appendChild(dialog);

            setTimeout(() => dialog.remove(), 4000);
        }

        function initNpcSystem() {
            const messages = [
                'å‡†å¤‡å¥½æ¥å—æµ‹è¯•äº†å—ï¼Ÿ',
                'ä½ çš„é€‰æ‹©å°†å†³å®šä½ çš„å‘½è¿...',
                'ä¸‡åœ£èŠ‚çš„é­”æ³•æ­£åœ¨è§‰é†’ï¼',
                'å°å¿ƒï¼Œä¸è¦è¢«å¤–è¡¨è¿·æƒ‘ï¼',
                'çœŸæ­£çš„åŠ›é‡æ¥è‡ªå†…å¿ƒï¼',
                'æˆ‘èƒ½æ„Ÿå—åˆ°ä½ çš„å‹‡æ°”...',
                'ç»§ç»­å‰è¿›ï¼ŒçœŸç›¸å°±åœ¨å‰æ–¹ï¼',
                'æ¯ä¸€æ¬¡é€‰æ‹©éƒ½æ˜¯æˆé•¿ï¼'
            ];

            // éšæœºæ˜¾ç¤ºNPCæ¶ˆæ¯
            setInterval(() => {
                const unreadMessages = messages.filter((msg, index) => !npcMessagesShown.includes(index));
                if (unreadMessages.length > 0 && Math.random() < 0.3) {
                    const randomIndex = Math.floor(Math.random() * unreadMessages.length);
                    const message = unreadMessages[randomIndex];
                    const originalIndex = messages.indexOf(message);
                    npcMessagesShown.push(originalIndex);
                    showNpcMessage(message);
                }
            }, 15000);
        }

        // 5. éšæœºäº‹ä»¶ç³»ç»Ÿ
        function triggerRandomEvent() {
            const events = [
                { type: 'equipment', message: 'ğŸ å‘ç°ç¥ç§˜å®ç®±ï¼è·å¾—éšæœºè£…å¤‡ï¼' },
                { type: 'skill', message: 'â­ ç¥ç§˜åŠ›é‡åŠ æŒï¼æŠ€èƒ½ç»éªŒ +1ï¼' },
                { type: 'weather', message: 'ğŸŒ©ï¸ å¤©æ°”çªå˜ï¼æ–°çš„ä½“éªŒç­‰ç€ä½ ï¼' },
                { type: 'minigame', message: 'ğŸ® è¿·ä½ å°æ¸¸æˆè§¦å‘ï¼' }
            ];

            const randomEvent = events[Math.floor(Math.random() * events.length)];

            const eventDiv = document.createElement('div');
            eventDiv.className = 'random-event';
            eventDiv.innerHTML = `
                <div style="font-size: 48px; margin-bottom: 20px;">ğŸ²</div>
                <div style="font-size: 24px; color: #9d4edd; margin-bottom: 15px;">éšæœºäº‹ä»¶ï¼</div>
                <div style="font-size: 18px;">${randomEvent.message}</div>
            `;
            document.body.appendChild(eventDiv);

            setTimeout(() => eventDiv.remove(), 3000);

            // æ‰§è¡Œäº‹ä»¶æ•ˆæœ
            setTimeout(() => {
                switch(randomEvent.type) {
                    case 'equipment': triggerEquipmentDrop(); break;
                    case 'skill': triggerSkillBoost(); break;
                    case 'weather': triggerWeatherChange(); break;
                    case 'minigame': triggerMiniGame(); break;
                }
            }, 3000);

            randomEventsTriggered.push(Date.now());
        }

        function triggerEquipmentDrop() {
            const items = [
                { name: 'å—ç“œå¸½', icon: 'ğŸ©', slot: 'hat', bonus: '+10% é€Ÿåº¦' },
                { name: 'å¹½çµæ–—ç¯·', icon: 'ğŸ¦‡', slot: 'cloak', bonus: '+15% ææƒ§æŠ—æ€§' },
                { name: 'é­”æ³•æ³•æ–', icon: 'ğŸ”®', slot: 'staff', bonus: '+20% ç‰¹æ•ˆè§¦å‘' },
                { name: 'é£å¤©é´', icon: 'ğŸ¥¾', slot: 'shoes', bonus: '+10% ç§»åŠ¨é€Ÿåº¦' }
            ];
            const item = items[Math.floor(Math.random() * items.length)];
            equipItem(item);
        }

        function triggerSkillBoost() {
            const skillTypes = ['å¿«é€Ÿæ€è€ƒ', 'ç›´è§‰æ´å¯Ÿ', 'ç¤¾äº¤é­…åŠ›', 'é€»è¾‘åˆ†æ', 'æƒ…ç»ªæ„ŸçŸ¥'];
            const randomType = skillTypes[Math.floor(Math.random() * skillTypes.length)];
            addSkillExperience(randomType);
        }

        function triggerWeatherChange() {
            const weathers = ['rain', 'snow', 'fog'];
            const randomWeather = weathers[Math.floor(Math.random() * weathers.length)];
            startWeather(randomWeather);
        }

        function triggerMiniGame() {
            const games = ['memory', 'reaction'];
            const randomGame = games[Math.floor(Math.random() * games.length)];
            startMiniGame(randomGame);
        }

        // 6. å¤©æ°”ç³»ç»Ÿ
        function startWeather(weatherType) {
            stopWeather();
            currentWeather = weatherType;
            const weatherContainer = document.createElement('div');
            weatherContainer.className = 'weather-effect';
            weatherContainer.id = 'weather-container';
            document.body.appendChild(weatherContainer);

            switch(weatherType) {
                case 'rain':
                    for (let i = 0; i < 50; i++) {
                        const drop = document.createElement('div');
                        drop.className = 'rain-drop';
                        drop.style.left = Math.random() * 100 + '%';
                        drop.style.animationDelay = Math.random() * 2 + 's';
                        weatherContainer.appendChild(drop);
                    }
                    break;
                case 'snow':
                    for (let i = 0; i < 30; i++) {
                        const flake = document.createElement('div');
                        flake.className = 'snow-flake';
                        flake.textContent = 'â„ï¸';
                        flake.style.left = Math.random() * 100 + '%';
                        flake.style.animationDelay = Math.random() * 3 + 's';
                        weatherContainer.appendChild(flake);
                    }
                    break;
                case 'fog':
                    for (let i = 0; i < 5; i++) {
                        const fog = document.createElement('div');
                        fog.className = 'fog-particle';
                        fog.style.top = Math.random() * 100 + '%';
                        fog.style.animationDelay = Math.random() * 5 + 's';
                        weatherContainer.appendChild(fog);
                    }
                    break;
            }
        }

        function stopWeather() {
            const weatherContainer = document.getElementById('weather-container');
            if (weatherContainer) {
                weatherContainer.remove();
            }
            currentWeather = null;
        }

        // 7. æ’è¡Œæ¦œç³»ç»Ÿ
        function showLeaderboard() {
            const leaderboard = document.createElement('div');
            leaderboard.className = 'leaderboard';
            leaderboard.innerHTML = `
                <div class="leaderboard-title">ğŸ† é€Ÿåº¦æ’è¡Œæ¦œ</div>
                <div id="leaderboard-list"></div>
                <button onclick="this.closest('.leaderboard').remove()"
                        style="margin-top: 20px; width: 100%; padding: 10px; background: #F8A51C; border: none; border-radius: 10px; color: black; cursor: pointer;">
                    å…³é—­
                </button>
            `;
            document.body.appendChild(leaderboard);

            updateLeaderboard();
        }

        function updateLeaderboard() {
            const saved = JSON.parse(localStorage.getItem('mbtiResults') || '[]');
            const sorted = saved.sort((a, b) => {
                const timeA = parseTime(a.timeSpent);
                const timeB = parseTime(b.timeSpent);
                return timeA - timeB;
            }).slice(0, 10);

            const list = document.getElementById('leaderboard-list');
            if (list) {
                list.innerHTML = sorted.map((result, index) => `
                    <div class="leaderboard-item">
                        <div class="leaderboard-rank">${index + 1}</div>
                        <div class="leaderboard-info">
                            <div class="leaderboard-name">${result.type} - ${result.timeSpent}</div>
                            <div class="leaderboard-time">${result.time}</div>
                        </div>
                        <div class="leaderboard-emoji">${result.emoji}</div>
                    </div>
                `).join('') || '<div style="text-align: center; color: #ccc; padding: 20px;">æš‚æ— è®°å½•</div>';
            }
        }

        function parseTime(timeStr) {
            const [minutes, seconds] = timeStr.split(':').map(Number);
            return minutes * 60 + seconds;
        }

        // 8. æ¯æ—¥æŒ‘æˆ˜ç³»ç»Ÿ
        function initDailyChallenge() {
            const challenge = document.getElementById('daily-challenge');
            challenge.classList.remove('hidden');

            const challenges = [
                { text: 'åœ¨60ç§’å†…å®Œæˆæµ‹è¯•', reward: 'é—ªç”µå¾½ç« ', icon: 'âš¡' },
                { text: 'ä¸æŸ¥çœ‹æç¤ºå®Œæˆæµ‹è¯•', reward: 'ç‹¬ç«‹å¾½ç« ', icon: 'ğŸ’ª' },
                { text: 'é€‰æ‹©æé™æ¨¡å¼å¹¶å®Œæˆ', reward: 'å‹‡æ°”å¾½ç« ', icon: 'ğŸ’€' },
                { text: 'å°è¯•æ‰€æœ‰4ä¸ªä¸»é¢˜', reward: 'æ¢ç´¢è€…å¾½ç« ', icon: 'ğŸ”' }
            ];

            const today = new Date().toDateString();
            const savedDate = localStorage.getItem('dailyChallengeDate');
            const savedChallenge = localStorage.getItem('dailyChallenge');

            if (savedDate !== today) {
                const randomChallenge = challenges[Math.floor(Math.random() * challenges.length)];
                localStorage.setItem('dailyChallengeDate', today);
                localStorage.setItem('dailyChallenge', JSON.stringify(randomChallenge));
                displayDailyChallenge(randomChallenge);
            } else {
                displayDailyChallenge(JSON.parse(savedChallenge));
            }
        }

        function displayDailyChallenge(challenge) {
            document.getElementById('daily-challenge-text').textContent = challenge.text;
            document.getElementById('daily-reward').textContent = challenge.icon + ' ' + challenge.reward;
        }

        // 9. å°æ¸¸æˆç³»ç»Ÿ
        function startMiniGame(gameType) {
            currentMiniGame = gameType;
            const gameDiv = document.createElement('div');
            gameDiv.className = 'mini-game';
            gameDiv.id = 'minigame-overlay';

            let content = '';
            if (gameType === 'memory') {
                content = `
                    <div class="mini-game-title">ğŸ§  è®°å¿†ç¿»ç‰Œæ¸¸æˆ</div>
                    <div class="mini-game-content">
                        <div style="text-align: center;">
                            <p style="color: white; margin-bottom: 20px;">æ‰¾å‡ºç›¸åŒçš„ç¬¦å·ï¼</p>
                            <div id="memory-grid" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; max-width: 400px; margin: 0 auto;"></div>
                            <div id="memory-score" style="color: #F8A51C; margin-top: 20px;">å¾—åˆ†: 0</div>
                        </div>
                    </div>
                `;
            } else if (gameType === 'reaction') {
                content = `
                    <div class="mini-game-title">âš¡ ååº”é€Ÿåº¦æµ‹è¯•</div>
                    <div class="mini-game-content">
                        <div style="text-align: center;">
                            <p style="color: white; margin-bottom: 20px;">çœ‹åˆ°ç»¿è‰²å°±ç‚¹å‡»ï¼</p>
                            <button id="reaction-btn" style="padding: 20px 40px; font-size: 24px; background: #F25C5C; border: none; border-radius: 15px; color: white; cursor: pointer;">ç­‰å¾…...</button>
                            <div id="reaction-score" style="color: #F8A51C; margin-top: 20px;">ç‚¹å‡»æ¬¡æ•°: 0 / 5</div>
                        </div>
                    </div>
                `;
            }

            gameDiv.innerHTML = content;
            document.body.appendChild(gameDiv);

            if (gameType === 'memory') {
                initMemoryGame();
            } else if (gameType === 'reaction') {
                initReactionGame();
            }
        }

        function initMemoryGame() {
            const symbols = ['ğŸƒ', 'ğŸ‘»', 'ğŸ¦‡', 'ğŸ•·ï¸', 'ğŸ’€', 'ğŸ©', 'ğŸ”®', 'ğŸ•¯ï¸'];
            const grid = document.getElementById('memory-grid');
            let score = 0;
            let flipped = [];
            let matched = [];

            // åˆ›å»º16å¼ ç‰Œï¼ˆ8å¯¹ï¼‰
            const cards = [...symbols, ...symbols].sort(() => Math.random() - 0.5);

            cards.forEach((symbol, index) => {
                const card = document.createElement('div');
                card.style.cssText = 'width: 80px; height: 80px; background: #6b1d9e; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 36px; cursor: pointer; transition: all 0.3s;';
                card.dataset.symbol = symbol;
                card.dataset.index = index;
                card.textContent = '?';
                card.onclick = () => flipCard(card);
                grid.appendChild(card);
            });

            function flipCard(card) {
                if (flipped.length < 2 && !flipped.includes(card) && !matched.includes(card)) {
                    card.textContent = card.dataset.symbol;
                    flipped.push(card);

                    if (flipped.length === 2) {
                        setTimeout(() => {
                            if (flipped[0].dataset.symbol === flipped[1].dataset.symbol) {
                                matched.push(...flipped);
                                flipped[0].style.background = '#F8A51C';
                                flipped[1].style.background = '#F8A51C';
                                score += 10;
                            } else {
                                flipped[0].textContent = '?';
                                flipped[1].textContent = '?';
                            }
                            flipped = [];
                            document.getElementById('memory-score').textContent = `å¾—åˆ†: ${score}`;
                            if (matched.length === 16) {
                                setTimeout(() => {
                                    addReward('memory-game', score);
                                    document.getElementById('minigame-overlay').remove();
                                }, 1000);
                            }
                        }, 1000);
                    }
                }
            }
        }

        function initReactionGame() {
            const btn = document.getElementById('reaction-btn');
            let clicks = 0;
            let gameActive = false;
            let timeout;

            btn.onclick = () => {
                if (!gameActive) {
                    // å¼€å§‹æ¸¸æˆ
                    gameActive = true;
                    clicks = 0;
                    updateReactionScore();
                    setTimeout(() => {
                        btn.style.background = '#00ff00';
                        btn.textContent = 'ç‚¹å‡»ï¼';
                        timeout = setTimeout(() => {
                            endReactionGame();
                        }, 3000);
                    }, Math.random() * 2000 + 1000);
                } else {
                    // ç‚¹å‡»æœ‰æ•ˆ
                    clicks++;
                    updateReactionScore();
                    if (clicks >= 5) {
                        clearTimeout(timeout);
                        endReactionGame();
                    }
                }
            };

            function updateReactionScore() {
                document.getElementById('reaction-score').textContent = `ç‚¹å‡»æ¬¡æ•°: ${clicks} / 5`;
            }

            function endReactionGame() {
                btn.style.background = '#F8A51C';
                btn.textContent = 'å®Œæˆï¼';
                setTimeout(() => {
                    addReward('reaction-game', clicks * 20);
                    document.getElementById('minigame-overlay').remove();
                }, 1000);
            }
        }

        function addReward(gameType, score) {
            gameStats.gamesPlayed++;
            if (gameType === 'memory-game' && score >= 80) {
                gameStats.perfectAnswers++;
            }
            if (gameType === 'reaction-game' && score >= 80) {
                gameStats.perfectAnswers++;
            }

            const rewards = {
                'memory-game': { name: 'è®°å¿†å®çŸ³', icon: 'ğŸ’' },
                'reaction-game': { name: 'é€Ÿåº¦ç¬¦æ–‡', icon: 'âš¡' }
            };

            const reward = rewards[gameType];
            showNpcMessage(`ğŸ æ¸¸æˆå¥–åŠ±ï¼š${reward.icon} ${reward.name}ï¼`);
        }

        // 10. éšæœºè§¦å‘ç³»ç»Ÿ
        function initRandomSystems() {
            // éšæœºäº‹ä»¶
            setInterval(() => {
                if (Math.random() < 0.1 && randomEventsTriggered.length < 5) {
                    triggerRandomEvent();
                }
            }, 20000);

            // æŠ€èƒ½ç»éªŒè‡ªåŠ¨å¢é•¿
            setInterval(() => {
                const skillTypes = ['å¿«é€Ÿæ€è€ƒ', 'ç›´è§‰æ´å¯Ÿ', 'ç¤¾äº¤é­…åŠ›', 'é€»è¾‘åˆ†æ', 'æƒ…ç»ªæ„ŸçŸ¥'];
                const randomType = skillTypes[Math.floor(Math.random() * skillTypes.length)];
                if (Math.random() < 0.3) {
                    addSkillExperience(randomType);
                }
            }, 30000);

            // è£…å¤‡éšæœºæ‰è½
            setInterval(() => {
                if (Math.random() < 0.15) {
                    triggerEquipmentDrop();
                }
            }, 60000);
        }

        // åˆå§‹åŒ–æ‰€æœ‰æ–°ç³»ç»Ÿ
        function initNewSystems() {
            initThemeSystem();
            initSkillSystem();
            initEquipmentSystem();
            initNpcSystem();
            initDailyChallenge();
            initRandomSystems();
        }

        // é€‰æ‹©ç­”æ¡ˆ
        function selectAnswer(index, value) {
            answers[currentQuestion] = value;
            document.querySelectorAll('#options .option').forEach(opt => {
                opt.classList.remove('selected');
            });
            document.querySelectorAll('#options .option')[index].classList.add('selected');
            document.getElementById('next-btn').classList.remove('hidden');
        }

        // ä¸‹ä¸€é¢˜
        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                // è§¦å‘é—®é¢˜åˆ‡æ¢ç‰¹æ•ˆ
                triggerQuestionTransition();

                setTimeout(() => {
                    currentQuestion++;
                    showQuestion();
                }, 800);
            } else {
                showResult();
            }
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult() {
            // åœæ­¢è®¡æ—¶å™¨
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            totalTime = Math.floor((Date.now() - startTime) / 1000);

            const counts = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
            answers.forEach(a => counts[a]++);

            let type = '';
            type += counts.E > counts.I ? 'E' : 'I';
            type += counts.S > counts.N ? 'S' : 'N';
            type += counts.T > counts.F ? 'T' : 'F';
            type += counts.J > counts.P ? 'J' : 'P';

            const personality = personalities[type];

            // è§¦å‘å®Œæˆæµ‹è¯•ç‰¹æ•ˆåˆé›†
            triggerCompletionEffects();

            // æ˜¾ç¤ºå®ŒæˆåŠ¨ç”»
            showCompletionAnimation();

            document.getElementById('quiz').classList.add('hidden');
            document.getElementById('result').classList.remove('hidden');
            document.getElementById('type-emoji').textContent = personality.emoji;
            document.getElementById('type-name').textContent = personality.name;
            document.getElementById('type-description').textContent = personality.description;

            // è®¡ç®—æˆå°±
            calculateAchievements();

            const traitsList = document.getElementById('traits');
            traitsList.innerHTML = '';
            personality.traits.forEach(trait => {
                const li = document.createElement('li');
                li.textContent = `â€¢ ${trait}`;
                li.style.margin = '10px 0';
                li.style.animation = `fadeInUp 0.5s ease ${traitsList.children.length * 0.1}s forwards`;
                li.style.opacity = '0';
                traitsList.appendChild(li);
            });

            document.getElementById('progress').style.width = '100%';
            document.getElementById('progress-text').textContent = '100% å®Œæˆï¼';

            // æ˜¾ç¤ºä¿å­˜æŒ‰é’®
            setTimeout(() => {
                document.getElementById('save-btn').style.display = 'block';
            }, 1000);
        }

        // æ˜¾ç¤ºå®ŒæˆåŠ¨ç”»
        function showCompletionAnimation() {
            const animation = document.createElement('div');
            animation.className = 'completion-animation';
            animation.textContent = 'ğŸ‰';
            document.body.appendChild(animation);

            setTimeout(() => animation.remove(), 1000);
        }

        // è®¡ç®—æˆå°±
        function calculateAchievements() {
            achievements = [];

            // é€Ÿåº¦æˆå°±
            if (totalTime < 30) {
                achievements.push({ icon: 'âš¡', name: 'é—ªç”µä¾ ', desc: '30ç§’å†…å®Œæˆ' });
            } else if (totalTime < 60) {
                achievements.push({ icon: 'ğŸƒ', name: 'å¿«èŠ‚å¥', desc: '1åˆ†é’Ÿå†…å®Œæˆ' });
            }

            // å®Œç¾æˆå°±
            if (currentQuestion === questions.length) {
                achievements.push({ icon: 'ğŸ’¯', name: 'å®Œç¾ä¸»ä¹‰è€…', desc: 'å®Œæˆæ‰€æœ‰é¢˜ç›®' });
            }

            // ä¸‡åœ£èŠ‚è¾¾äººæˆå°±
            achievements.push({ icon: 'ğŸƒ', name: 'ä¸‡åœ£èŠ‚æ¢é™©å®¶', desc: 'å®Œæˆæµ‹è¯•' });

            // æƒŠå“æ¨¡å¼æˆå°±
            if (selectedLevel === 'extreme') {
                achievements.push({ icon: 'ğŸ’€', name: 'æ­»ç¥æŒ‘æˆ˜è€…', desc: 'é€‰æ‹©æé™æ¨¡å¼' });
                achievements.push({ icon: 'ğŸ˜±', name: 'æ— ç•å‹‡å£«', desc: 'åœ¨æƒŠå“ä¸­å®Œæˆæµ‹è¯•' });
            } else if (selectedLevel === 'normal') {
                achievements.push({ icon: 'ğŸ‘»', name: 'å‹‡æ•¢æ¢ç´¢è€…', desc: 'é€‰æ‹©æ ‡å‡†æ¨¡å¼' });
            } else {
                achievements.push({ icon: 'ğŸŒ™', name: 'å°å¿ƒè°¨æ…', desc: 'é€‰æ‹©æ¸©å’Œæ¨¡å¼' });
            }

            // ç‰¹æ®Šæˆå°±ï¼šå¦‚æœç»å†äº†æƒŠå“å¹¶ä¿æŒå†·é™
            if (scareActive) {
                achievements.push({ icon: 'ğŸ§ ', name: 'å†·é™å¤§å¸ˆ', desc: 'åœ¨æƒŠå“ä¸­ä¿æŒé•‡å®š' });
            }

            // æ˜¾ç¤ºæˆå°±
            const achievementsContainer = document.getElementById('achievements');
            achievementsContainer.innerHTML = '<h4 style="color: #FFD700; margin-bottom: 15px;">ğŸ† è·å¾—æˆå°±</h4>';
            achievements.forEach((achievement, index) => {
                const div = document.createElement('div');
                div.className = 'achievement';
                div.style.animationDelay = `${index * 0.2}s`;
                div.innerHTML = `${achievement.icon} ${achievement.name} - ${achievement.desc}`;
                achievementsContainer.appendChild(div);
            });
        }

        // åˆ†äº«åŠŸèƒ½
        function shareToWeChat() {
            const type = document.getElementById('type-name').textContent;
            const emoji = document.getElementById('type-emoji').textContent;
            const text = `æˆ‘åœ¨ä¸‡åœ£èŠ‚MBTIæµ‹è¯•ä¸­æ˜¯ï¼š${emoji} ${type}ï¼å¿«æ¥æµ‹è¯•ä½ çš„ä¸‡åœ£èŠ‚äººæ ¼å§ï¼`;
            alert(`åˆ†äº«åˆ°å¾®ä¿¡ï¼š\n${text}\n\nï¼ˆè¯·æ‰‹åŠ¨å¤åˆ¶åˆ°å¾®ä¿¡ï¼‰`);
        }

        function shareToQQ() {
            const type = document.getElementById('type-name').textContent;
            const emoji = document.getElementById('type-emoji').textContent;
            const text = `æˆ‘åœ¨ä¸‡åœ£èŠ‚MBTIæµ‹è¯•ä¸­æ˜¯ï¼š${emoji} ${type}ï¼å¿«æ¥æµ‹è¯•ä½ çš„ä¸‡åœ£èŠ‚äººæ ¼å§ï¼`;
            alert(`åˆ†äº«åˆ°QQï¼š\n${text}\n\nï¼ˆè¯·æ‰‹åŠ¨å¤åˆ¶åˆ°QQï¼‰`);
        }

        function copyResult() {
            const type = document.getElementById('type-name').textContent;
            const emoji = document.getElementById('type-emoji').textContent;
            const description = document.getElementById('type-description').textContent;
            const traits = Array.from(document.querySelectorAll('#traits li')).map(li => li.textContent).join('\n');
            const achievementsText = achievements.map(a => a.icon + ' ' + a.name).join(' ');

            const text = `ğŸƒ ä¸‡åœ£èŠ‚MBTIæµ‹è¯•ç»“æœ\n\n${emoji} ${type}\n\n${description}\n\n${traits}\n\n${achievementsText}\n\nç”¨æ—¶ï¼š${Math.floor(totalTime / 60)}:${String(totalTime % 60).padStart(2, '0')}`;

            navigator.clipboard.writeText(text).then(() => {
                alert('âœ… ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            }).catch(() => {
                // å¤‡ç”¨æ–¹æ¡ˆ
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                textarea.remove();
                alert('âœ… ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            });
        }

        // ä¿å­˜ç»“æœ
        function saveResult() {
            const type = document.getElementById('type-name').textContent;
            const emoji = document.getElementById('type-emoji').textContent;
            const description = document.getElementById('type-description').textContent;

            const result = {
                type: type,
                emoji: emoji,
                description: description,
                time: new Date().toLocaleString(),
                timeSpent: `${Math.floor(totalTime / 60)}:${String(totalTime % 60).padStart(2, '0')}`,
                achievements: achievements
            };

            const saved = JSON.parse(localStorage.getItem('mbtiResults') || '[]');
            saved.push(result);
            localStorage.setItem('mbtiResults', JSON.stringify(saved));

            alert('ğŸ’¾ ç»“æœå·²ä¿å­˜ï¼å¯ä»¥éšæ—¶æŸ¥çœ‹å†å²è®°å½•ã€‚');
        }

        // é‡æ–°å¼€å§‹
        function restart() {
            currentQuestion = 0;
            answers = [];
            selectedLevel = 'normal';
            startTime = null;
            totalTime = 0;
            achievements = [];
            scareActive = false;

            if (timerInterval) {
                clearInterval(timerInterval);
            }
            if (scaryElementsInterval) {
                clearInterval(scaryElementsInterval);
            }

            // éšè—æƒŠå“ç›¸å…³UI
            document.getElementById('scare-indicator').classList.add('hidden');
            document.getElementById('sound-wave').classList.add('hidden');
            document.getElementById('level-warning').classList.add('hidden');

            // éšè—ä¿å­˜æŒ‰é’®
            document.getElementById('save-btn').style.display = 'none';

            // æ¸…ç†æ‰€æœ‰ææ€–å…ƒç´ å’Œç‚«é…·ç‰¹æ•ˆ
            const selectors = [
                '.ghost-walk', '.bat-fly', '.pumpkin-glow', '.spider-swing', '.will-o-wisp',
                '.scare-msg', '.scary-element', '.rainbow-stream', '.magic-circle', '.lightning-bolt',
                '.energy-wave', '.firework', '.floating-text', '.black-hole', '.aurora',
                '.mega-msg', '.cube', '.portal', '.hologram-text', '.hologram-effect',
                '.completion-animation'
            ];
            selectors.forEach(selector => {
                document.querySelectorAll(selector).forEach(el => el.remove());
            });

            // ç§»é™¤bodyä¸Šçš„ç‰¹æ•ˆç±»
            document.body.classList.remove('screen-shake', 'screen-flash', 'mega-shake', 'time-slow');

            document.getElementById('result').classList.add('hidden');
            document.getElementById('level-selection').classList.remove('hidden');
            document.getElementById('quiz').classList.add('hidden');
        }

        // åˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', () => {
            createStars();
            initNewSystems(); // åˆå§‹åŒ–æ‰€æœ‰æ–°ç³»ç»Ÿ
            setTimeout(() => {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('level-selection').classList.remove('hidden');
            }, 2000);
        });
    </script>
</body>
</html>
