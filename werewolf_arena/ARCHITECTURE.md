# Werewolf Arena v2.0 æ¶æ„æ–‡æ¡£

## ğŸ—ï¸ é¡¹ç›®æ¦‚è§ˆ

Werewolf Arena æ˜¯ä¸€ä¸ªåŸºäºAIçš„ç‹¼äººæ€æ¸¸æˆå¹³å°ï¼Œä½¿ç”¨å¤§è¯­è¨€æ¨¡å‹ä½œä¸ºæ¸¸æˆç©å®¶ã€‚é¡¹ç›®é‡‡ç”¨ç°ä»£åŒ–çš„å¾®æœåŠ¡æ¶æ„ï¼Œæä¾›å®æ—¶æ¸¸æˆä½“éªŒå’Œä¸°å¯Œçš„äº¤äº’åŠŸèƒ½ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å¯åŠ¨é¡¹ç›®
```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd werewolf_arena

# å¯åŠ¨æœåŠ¡ï¼ˆä¸»å¯åŠ¨è„šæœ¬ï¼‰
./scripts/start_v2.sh
```

å¯åŠ¨åå¯è®¿é—®ï¼š
- **æ¸¸æˆä¸»é¡µ**: http://localhost:3000
- **APIæ–‡æ¡£**: http://localhost:8000/docs
- **å¥åº·æ£€æŸ¥**: http://localhost:8000/health

## ğŸ“ é¡¹ç›®ç»“æ„

```
werewolf_arena/
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ start_v2.sh          # ğŸ¯ ä¸»å¯åŠ¨è„šæœ¬
â”‚   â””â”€â”€ stop_v2.sh           # åœæ­¢è„šæœ¬ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”œâ”€â”€ backend/                 # ğŸ”§ FastAPIåç«¯æœåŠ¡
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ api/            # APIè·¯ç”±å±‚
â”‚   â”‚   â”‚   â””â”€â”€ v1/         # API v1ç‰ˆæœ¬
â”‚   â”‚   â”‚       â”œâ”€â”€ routes/ # è·¯ç”±å®šä¹‰
â”‚   â”‚   â”‚       â””â”€â”€ schemas/ # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ core/           # ğŸ® æ¸¸æˆæ ¸å¿ƒé€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ game/       # æ¸¸æˆå¼•æ“
â”‚   â”‚   â”‚   â””â”€â”€ models/     # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ services/       # ğŸ¤– ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ llm/        # LLMå®¢æˆ·ç«¯
â”‚   â”‚   â”‚   â””â”€â”€ game_manager/ # æ¸¸æˆç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ config/         # âš™ï¸ é…ç½®ç®¡ç†
â”‚   â”‚   â””â”€â”€ utils/          # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ tests/              # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ requirements.txt    # Pythonä¾èµ–
â”‚   â”œâ”€â”€ .env                # ç¯å¢ƒå˜é‡
â”‚   â””â”€â”€ Dockerfile          # Dockeré…ç½®
â”œâ”€â”€ frontend/               # ğŸŒ Next.jså‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ app/           # Next.js App Router
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx   # é¦–é¡µ
â”‚   â”‚   â”‚   â””â”€â”€ live/      # æ¸¸æˆç›´æ’­é¡µé¢
â”‚   â”‚   â”œâ”€â”€ components/    # Reactç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ui/        # UIåŸºç¡€ç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ game/      # æ¸¸æˆç›¸å…³ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ lib/           # ğŸ”§ å·¥å…·åº“
â”‚   â”‚   â”‚   â”œâ”€â”€ api/       # APIå®¢æˆ·ç«¯
â”‚   â”‚   â”‚   â”œâ”€â”€ hooks/     # React Hooks
â”‚   â”‚   â”‚   â””â”€â”€ store/     # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ types/         # TypeScriptç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ public/            # é™æ€èµ„æº
â”‚   â”œâ”€â”€ package.json       # Node.jsä¾èµ–
â”‚   â””â”€â”€ Dockerfile         # Dockeré…ç½®
â”œâ”€â”€ shared/                # ğŸ”„ å‰åç«¯å…±äº«ä»£ç 
â”‚   â””â”€â”€ types/             # å…±äº«ç±»å‹å®šä¹‰
â”œâ”€â”€ logs/                  # ğŸ“ æ—¥å¿—æ–‡ä»¶ç›®å½•
â”œâ”€â”€ docs/                  # ğŸ“š é¡¹ç›®æ–‡æ¡£
â””â”€â”€ README.md              # é¡¹ç›®è¯´æ˜
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### åç«¯ (FastAPI)
- **æ¡†æ¶**: FastAPI 0.104+
- **Pythonç‰ˆæœ¬**: Python 3.11+
- **æœåŠ¡å™¨**: Uvicorn
- **å¼‚æ­¥**: asyncio, aiohttp
- **é…ç½®**: pydantic-settings
- **æ—¥å¿—**: structlog
- **æµ‹è¯•**: pytest

### å‰ç«¯ (Next.js)
- **æ¡†æ¶**: Next.js 14 (App Router)
- **UIåº“**: React 18
- **è¯­è¨€**: TypeScript 5.3+
- **æ ·å¼**: TailwindCSS 3.3+
- **çŠ¶æ€ç®¡ç†**: Zustand 4.4+
- **HTTPå®¢æˆ·ç«¯**: Axios 1.6+
- **å›¾æ ‡**: Lucide React

### å¼€å‘å·¥å…·
- **å®¹å™¨åŒ–**: Docker, Docker Compose
- **ä»£ç è´¨é‡**: ESLint, Prettier, TypeScript
- **æµ‹è¯•**: Jest, React Testing Library
- **ç¯å¢ƒç®¡ç†**: Python venv, npm

## ğŸ”„ ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Next.js       â”‚    â”‚   FastAPI       â”‚    â”‚   LLM APIs      â”‚
â”‚   Frontend      â”‚â—„â”€â”€â–ºâ”‚   Backend       â”‚â—„â”€â”€â–ºâ”‚   (å¤–éƒ¨æœåŠ¡)     â”‚
â”‚   (Port 3000)   â”‚    â”‚   (Port 8000)   â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚   æ¸¸æˆçŠ¶æ€å­˜å‚¨    â”‚
                       â”‚   (å†…å­˜ + æ—¥å¿—)   â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµ
1. **ç”¨æˆ·æ“ä½œ** â†’ Next.jså‰ç«¯
2. **APIè¯·æ±‚** â†’ FastAPIåç«¯
3. **æ¸¸æˆé€»è¾‘** â†’ Game Masterå¼•æ“
4. **LLMè°ƒç”¨** â†’ å¤–éƒ¨AIæœåŠ¡
5. **å®æ—¶æ›´æ–°** â†’ WebSocketæ¨é€åˆ°å‰ç«¯

## ğŸ® æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. æ¸¸æˆç®¡ç† (Game Management)
- **ä½ç½®**: `backend/src/services/game_manager/`
- **åŠŸèƒ½**:
  - æ¸¸æˆä¼šè¯ç®¡ç†
  - ç©å®¶çŠ¶æ€è·Ÿè¸ª
  - æ¸¸æˆæµç¨‹æ§åˆ¶
  - å®æ—¶æ—¥å¿—è®°å½•

### 2. LLMé›†æˆ (LLM Integration)
- **ä½ç½®**: `backend/src/services/llm/`
- **åŠŸèƒ½**:
  - å¤šAIæä¾›å•†æ”¯æŒ
  - æ¨¡å‹é…ç½®ç®¡ç†
  - å¼‚æ­¥APIè°ƒç”¨
  - é”™è¯¯é‡è¯•æœºåˆ¶

### 3. å®æ—¶é€šä¿¡ (Real-time Communication)
- **ä½ç½®**: `backend/src/api/v1/routes/websocket.py`
- **åŠŸèƒ½**:
  - WebSocketè¿æ¥ç®¡ç†
  - æ¸¸æˆçŠ¶æ€å®æ—¶æ¨é€
  - ç©å®¶äº’åŠ¨åŒæ­¥

### 4. å‰ç«¯çŠ¶æ€ç®¡ç† (Frontend State)
- **ä½ç½®**: `frontend/src/lib/store/`
- **åŠŸèƒ½**:
  - æ¸¸æˆçŠ¶æ€ç®¡ç†
  - UIçŠ¶æ€åŒæ­¥
  - æ•°æ®ç¼“å­˜ä¼˜åŒ–

## ğŸ”Œ APIæ¥å£è®¾è®¡

### RESTful APIç«¯ç‚¹
```
GET  /api/v1/games              # è·å–æ¸¸æˆåˆ—è¡¨
POST /api/v1/games              # åˆ›å»ºæ–°æ¸¸æˆ
GET  /api/v1/games/{id}         # è·å–æ¸¸æˆè¯¦æƒ…
DELETE /api/v1/games/{id}       # åˆ é™¤æ¸¸æˆ
GET  /api/v1/games/{id}/logs    # è·å–æ¸¸æˆæ—¥å¿—
GET  /api/v1/models             # è·å–å¯ç”¨æ¨¡å‹
GET  /api/v1/status             # ç³»ç»ŸçŠ¶æ€
```

### WebSocketäº‹ä»¶
```typescript
// å®¢æˆ·ç«¯äº‹ä»¶
game.join      // åŠ å…¥æ¸¸æˆ
game.leave     // ç¦»å¼€æ¸¸æˆ
game.start     // å¼€å§‹æ¸¸æˆ
game.stop      // åœæ­¢æ¸¸æˆ

// æœåŠ¡ç«¯äº‹ä»¶
game.state     // æ¸¸æˆçŠ¶æ€æ›´æ–°
game.message   // æ¸¸æˆæ¶ˆæ¯
game.error     // é”™è¯¯ä¿¡æ¯
```

## ğŸ¯ æ ¸å¿ƒç»„ä»¶è¯¦è§£

### Game Master (æ¸¸æˆä¸»æ§)
- **æ–‡ä»¶**: `backend/src/core/game/game_master.py`
- **èŒè´£**:
  - æ§åˆ¶æ¸¸æˆæµç¨‹
  - ç®¡ç†è§’è‰²è¡Œä¸º
  - å¤„ç†æ¸¸æˆäº‹ä»¶
  - åˆ¤å®šæ¸¸æˆç»“æœ

### Player Model (ç©å®¶æ¨¡å‹)
- **æ–‡ä»¶**: `backend/src/core/models/player.py`
- **èŒè´£**:
  - ç©å®¶çŠ¶æ€ç®¡ç†
  - è§’è‰²èƒ½åŠ›å®ç°
  - AIå†³ç­–é€»è¾‘

### LLM Client (AIå®¢æˆ·ç«¯)
- **æ–‡ä»¶**: `backend/src/services/llm/client.py`
- **èŒè´£**:
  - ç»Ÿä¸€AIæ¥å£
  - å¤šæä¾›å•†é€‚é…
  - å¹¶å‘è¯·æ±‚ç®¡ç†

## ğŸ”§ é…ç½®ç®¡ç†

### ç¯å¢ƒå˜é‡é…ç½®
```bash
# åç«¯é…ç½® (backend/.env)
OPENAI_API_KEY=your_openai_key
GLM_API_KEY=your_glm_key
DEBUG=false
LOG_LEVEL=info

# å‰ç«¯é…ç½® (frontend/.env.local)
NEXT_PUBLIC_API_URL=http://localhost:8000
```

### æ¸¸æˆé…ç½®
- **æ–‡ä»¶**: `backend/src/config/timing_loader.py`
- **åŠŸèƒ½**: æ¸¸æˆæ—¶é—´é…ç½®ã€è§’è‰²è®¾ç½®ç­‰

## ğŸš€ éƒ¨ç½²æ–¹æ¡ˆ

### Dockeréƒ¨ç½²
```bash
# æ„å»ºå¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

### ç”Ÿäº§ç¯å¢ƒ
- **åå‘ä»£ç†**: Nginx
- **è¿›ç¨‹ç®¡ç†**: Supervisor
- **ç›‘æ§**: è‡ªå®šä¹‰å¥åº·æ£€æŸ¥
- **æ—¥å¿—**: ç»“æ„åŒ–æ—¥å¿—è¾“å‡º

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### åç«¯æµ‹è¯•
```bash
cd backend
pytest tests/ -v --cov=src
```

### å‰ç«¯æµ‹è¯•
```bash
cd frontend
npm run test
npm run test:e2e  # ç«¯åˆ°ç«¯æµ‹è¯•
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### åç«¯ä¼˜åŒ–
- **å¼‚æ­¥å¤„ç†**: å…¨é¢ä½¿ç”¨asyncio
- **è¿æ¥æ± **: HTTPå®¢æˆ·ç«¯è¿æ¥å¤ç”¨
- **ç¼“å­˜æœºåˆ¶**: æ¸¸æˆçŠ¶æ€å†…å­˜ç¼“å­˜
- **æ‰¹å¤„ç†**: LLMè¯·æ±‚æ‰¹é‡ä¼˜åŒ–

### å‰ç«¯ä¼˜åŒ–
- **ä»£ç åˆ†å‰²**: Next.jsè‡ªåŠ¨ä»£ç åˆ†å‰²
- **ç»„ä»¶æ‡’åŠ è½½**: åŠ¨æ€å¯¼å…¥å¤§å‹ç»„ä»¶
- **çŠ¶æ€ä¼˜åŒ–**: Zustandé€‰æ‹©å™¨ä¼˜åŒ–
- **ç¼“å­˜ç­–ç•¥**: APIå“åº”ç¼“å­˜

## ğŸ”’ å®‰å…¨è€ƒè™‘

- **APIå¯†é’¥ç®¡ç†**: ç¯å¢ƒå˜é‡éš”ç¦»
- **CORSé…ç½®**: è·¨åŸŸè¯·æ±‚æ§åˆ¶
- **è¾“å…¥éªŒè¯**: Pydanticæ¨¡å‹éªŒè¯
- **é”™è¯¯å¤„ç†**: æ•æ„Ÿä¿¡æ¯è¿‡æ»¤

## ğŸ“ å¼€å‘è§„èŒƒ

### ä»£ç é£æ ¼
- **Python**: Black + isort + flake8
- **TypeScript**: Prettier + ESLint
- **æäº¤ä¿¡æ¯**: Conventional Commits

### åˆ†æ”¯ç­–ç•¥
- `main`: ç”Ÿäº§ç¯å¢ƒåˆ†æ”¯
- `develop`: å¼€å‘ç¯å¢ƒåˆ†æ”¯
- `feature/*`: åŠŸèƒ½å¼€å‘åˆ†æ”¯
- `hotfix/*`: ç´§æ€¥ä¿®å¤åˆ†æ”¯

## ğŸ”® æœªæ¥è§„åˆ’

### çŸ­æœŸç›®æ ‡
- [ ] æ·»åŠ æ›´å¤šAIæ¨¡å‹æ”¯æŒ
- [ ] å®ç°æ¸¸æˆå›æ”¾åŠŸèƒ½
- [ ] ä¼˜åŒ–å®æ—¶æ€§èƒ½
- [ ] å¢å¼ºé”™è¯¯å¤„ç†

### é•¿æœŸç›®æ ‡
- [ ] å¤šæˆ¿é—´æ¸¸æˆæ”¯æŒ
- [ ] ç”¨æˆ·è´¦æˆ·ç³»ç»Ÿ
- [ ] æ’è¡Œæ¦œåŠŸèƒ½
- [ ] ç§»åŠ¨ç«¯é€‚é…

---

*è¯¥æ–‡æ¡£æè¿°äº†Werewolf Arena v2.0çš„å®Œæ•´æ¶æ„è®¾è®¡ï¼Œä¸ºå¼€å‘å’Œç»´æŠ¤æä¾›è¯¦ç»†æŒ‡å¯¼ã€‚*